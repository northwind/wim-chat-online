Ext.ChatTabPanel=function(){Ext.ChatTabPanel.superclass.constructor.call(this,{id:"chat-body",renderTo:"WIM_Chat_Main",resizeTabs:true,minTabWidth:135,deferredRender:false,tabWidth:135,enableTabScroll:true,animScroll:true,activeTab:0,items:[new WIM.FlashPlayer({url:"flash/flash.html"})],height:369});this.on("remove",this.removeTask,this)};Ext.extend(Ext.ChatTabPanel,Ext.TabPanel,{TextIndex:"Index",urlIndex:"http://www.g.cn",addTask:function(b){var c;b.closable=true;switch(b.type){case 1:c=new WIM.Win.ChatPanel(b);break;case 2:c=new WIM.Win.QunChatPanel(b);break;case 4:c=new WIM.Win.EditProfile(b);break;case 5:c=new WIM.Win.ManageQun(b);break;case 6:c=new WIM.Win.LookProfile(b);break}if(c){this.activate(this.add(c))}if(b.fn){b.fn.call(b.scope||b.data||window)}},activeTask:function(a){var b=this.getComponent(a.id);if(b){this.activate(b)}},removeTask:function(a,b){T.Bubble.RemoveTask(b.id)},afterRender:function(b,a){Ext.ChatTabPanel.superclass.afterRender.call(this,b,a);Ext.EventManager.on(document,"keydown",this.onKeydown,this)},onKeydown:function(b){var a=this.getActiveTab();if(a&&!a.onKeydown||a.onKeydown&&a.onKeydown.apply(a,arguments)!==false){if(b.altKey){if(b.getCharCode()==67&&a.closable){b.preventDefault();this.remove(this.getActiveTab().id)}}}},minLeft:100000,maxRight:0,alertLeft:function(c){c=this.minLeft=Math.min(this.minLeft,c);var f=this.getScrollPos(),d=this.getScrollArea();if(f!=0&&c<f&&!this.timerLeft){var a=this;function b(){if(a.getScrollPos()<=a.minLeft&&a.timerLeft){clearInterval(a.timerLeft);a.timerLeft=null;e.removeClass("x-tab-scroller-left-over");e.unbind("click",b)}}var e=this.scrollLeft.j.click(b);this.timerLeft=setInterval(function(){e.toggleClass("x-tab-scroller-left-over")},200)}},alertRight:function(d){d=this.maxRight=Math.max(this.maxRight,d);var f=this.getScrollPos(),e=this.getScrollArea();if(d>f+e&&!this.timerRight){var a=this;function b(){if(a.getScrollPos()+a.getScrollArea()>=a.maxRight&&a.timerRight){clearInterval(a.timerRight);a.timerRight=null;c.removeClass("x-tab-scroller-right-over");c.unbind("click",b)}}var c=this.scrollRight.j.click(b);this.timerRight=setInterval(function(){c.toggleClass("x-tab-scroller-right-over")},200)}}});WIM.MessagePanel=function(a){Ext.apply(this,a||{});WIM.MessagePanel.superclass.constructor.call(this,arguments);return this};Ext.extend(WIM.MessagePanel,Ext.BoxComponent,{messages:{},baseCls:"wim-cpanel-message scroll",selfCls:"wim-cpanel-selfHd",buddyCls:"wim-cpanel-buddyHd",timeCls:"wim-cpanel-time",contentCls:"wim-cpanel-content",failCls:"wim-cpanel-fail",infoCls:"wim-cpanel-info",onRender:function(b,a){WIM.MessagePanel.superclass.onRender.call(this,b,a);this.el=b.createChild({id:this.id,cls:this.baseCls},a);this.jel=$(this.el.dom);this.initInfo()},initInfo:function(){this.info=$("<div/>").insertBefore(this.jel).addClass(this.infoCls).css("heigth","0")},bulk:false,addMessage:function(a){if($.isArray(a)||a.each){this.bulk=true;a.each(function(c,d){this.addMessage(d)},this);this.bulk=false;this.scroll()}else{if(a.date){var b=this.renderMsg(a).appendTo(this.jel);this.messages[+a.date]=b;this.scroll()}}},scroll:function(){if(!this.bulk){this.jel.scrollTop(10000)}},renderMsg:function(a){var d=$("<div/>");var h=$("<div/>").addClass(a.isSelf()?this.selfCls:this.buddyCls);var c=$("<span/>").html(a.getName()).appendTo(h);var f=$("<span/>").addClass(this.timeCls).html(a.getDate()).appendTo(h);var b=$("<span/>").appendTo(h);var e=$("<div/>").addClass(this.contentCls).html(this.transfer(a.getContent()));return d.append(h).append(e)},transfer:function(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br/>")},faildMsg:function(a){var b=this.messages[+a.date];if(b){b.addClass(this.failCls);b.find("div > span:eq(2)").html("sended failed")}},findMsg:function(a){var b=typeof a=="string"?a:$(a.getContent()).text();return this.jel.find("div:contains('"+b+"')")},clear:function(){this.jel.empty();this.messages={};return this},addInfo:function(b,c){this.info.width(this.jel.width());if(this.info){this.info.stop()}var a=this;this.info.height(0).html(b).height("auto").animate({height:"show"},"slow",function(){setTimeout(function(){a.info.animate({height:0},"slow",function(){a.info.empty()})},c||3500)})}});WIM.Win.ChatPanel=function(){var a=WIM.K.getJson("logout");WIM.Apply(this,a);WIM.Win.ChatPanel.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.Win.ChatPanel,Ext.BoxComponent,{TextLookPref:"View Profile",TextClose:"&nbsp;Close(<u>C</u>) ",TextSend:" Send(<u>S</u>) ",TextEnter:"Press Enter",TextCtrl:"Press Ctrl+Enter",TextFast:"too fast, please hava a rest",TextClear:"Clear",TextEmpty:"Can't send empty",TextTyping:"is typing",TextHistory:"Chat History",ctrlKey:false,infoHidden:false,autoScroll:true,distance:3000,count:2,hits:0,cls:"wim-cpanel-body",partCls:"wim-cpanel-part",SelIconCls:"wim-select",width:"100%",height:"100%",onRender:function(b,a){this.table=$('<table cellpadding="0" cellspacing="0"/>').css("table-layout","fixed");this.tr=$("<tr>").appendTo(this.table).height("100%");this.initLeft();this.initMiddle();this.initRight();this.el=this.table[0];WIM.Win.ChatPanel.superclass.onRender.call(this,b,a)},setData:function(a){this.data=a},initLeft:function(){this.left=$("<td>").addClass("cp-left");this.initHeader();this.initMsg();this.initTool();this.initInput();this.initFooter();this.left.appendTo(this.tr)},initHeader:function(){this.header=new Ext.Toolbar({renderTo:this.left[0],cls:"cp-header"}).render();this.header.add({text:this.TextHistory,handler:this.history,scope:this},{text:this.TextLookPref,handler:function(){T.Bubble.LookPref(this.data)},scope:this})},history:function(){this.msgPanel.clear().addMessage(this.data.messages.get(150))},initMsg:function(){this.msgPanel=new WIM.MessagePanel().render(this.left[0])},initInput:function(){this.inputField=new Ext.form.Field({cls:"wim-cpanel-text",el:$('<textarea wrap="hard"></textarea>').appendTo(this.left)[0],listeners:{keydown:{fn:this.fireKeyInput,scope:this},focus:{fn:this.initTypeListener,scope:this},blur:{fn:this.removeListener,scope:this}}}).render()},fireKeyInput:function(a,b){if(b.getKey()==b.ENTER){b.stopEvent();if(this.ctrlKey&&b.ctrlKey||!this.ctrlKey&&!b.ctrlKey){this.sendMsg()}else{if(!this.ctrlKey&&b.ctrlKey){this.inputField.setValue(this.inputField.getValue()+"\r\n");if(this.range){this.range.collapse(false);this.range.select()}}}return false}return true},initTool:function(){this.toolbar=new Ext.Toolbar({renderTo:this.left[0]}).render();this.toolbar.add({text:this.TextClear,handler:this.msgPanel.clear,scope:this.msgPanel})},initFooter:function(){this.footer=new Ext.Toolbar({cls:"last-bar",renderTo:this.left[0]}).render();this.footer.add("","->",{text:this.TextClose,handler:function(){WIM.ChatTabPanel.remove(this.id)},scope:this},{text:this.TextSend,handler:this.sendMsg,scope:this},"-",{text:"",menu:new Ext.menu.Menu({defaults:{handler:this.changeHotKey,scope:this},items:[{text:this.TextEnter,iconCls:this.SelIconCls,ctrlKey:false},{text:this.TextCtrl,ctrlKey:true}]})});this.scrollMsg=$(this.footer.items.items[0].el)},initMiddle:function(){this.middle=$("<td><a class='right' href='javascript:void(0)'>&nbsp;</a></td>").addClass("cp-middle").appendTo(this.tr)},TextSign:"Sign",TextBlog:"Blog",TextCity:"City",TextSite:"Site",TextAt:"Site",TextInfoTl:"Visualize",initRight:function(){this.right=$("<td>").addClass("cp-right").append(['<div class="info"><div class="x-header">',this.TextInfoTl,'</div><div class="main">','<div class="head" title="',this.data.getName(),'"><img src="',Ext.BLANK_IMAGE_URL,'" />',this.data.getName(),"</div>",'<div class="sign" title="',this.data.signature,'">',this.data.signature,'</div><div class="case">',"<label>",this.TextBlog,"</label><a ",this.data.profile.blog.length==0?"":'target="_blank"',' title="',this.data.profile.blog,'" href="',this.data.profile.blog.url(),'"class="anchor">',this.data.profile.blog,"</a></div></div></div>"].join("")).appendTo(this.tr)},afterRender:function(){WIM.Win.ChatPanel.superclass.afterRender.call(this);var b=0;this.left.children().each(function(){b+=$(this).outerHeight(true)});if(this.container.getHeight()>b){this.msgPanel.setHeight(this.container.getHeight()-b+this.msgPanel.el.getHeight())}this.msgPanel.el.j.height(this.msgPanel.el.j.height());if($.browser.msie){this.range=($("textarea",this.inputField.el.dcom)[0]).createTextRange()}var a=this;this.partBtn=this.middle.find("a").addClass("noborder").toggle(function(){a.hideRight();$(this).toggleClass("left")},function(){a.showRight();$(this).toggleClass("left")});if(this.infoHidden){this.partBtn.click()}this.msgPanel.addMessage(this.data.messages.get(10));this.on("show",this.stopAlert,this)},hideRight:function(){this.right.hide();this.left.data("oldwidth",this.left.width()).width("98%")},showRight:function(){this.right.show();this.left.width("70%")},changeHotKey:function(a){a.parentMenu.items.each(function(c){c.setIconClass("")});a.setIconClass(this.SelIconCls);this.ctrlKey=a.ctrlKey;var b=Ext.encode(WIM.K.getJson("custom").ctrlKey=this.ctrlKey);WIM.K.set("custom",b)},getInput:function(){return this.inputField.getValue()},guard:0,max:5,last:new Date().getTime(),scout:500,sendMsg:function(){var c=this.getInput();if(c.length>0){this.now=new Date().getTime();if((this.now-this.last)<this.scout){this.guard++}else{this.guard=0}if(this.guard>this.max){this.msgPanel.addInfo(this.TextFast);this.guard--}else{this.last=this.now;if(c!=""){this.inputField.setValue("");this.inputField.focus();this.invokeMessage(c);var b="";try{b=(p||window).WIM._me.domainPref.adMsg}catch(a){}if(this.data.firstChat&&b.length>0){this.data.firstChat=false;this.data.sendMsg(b,false)}}}}else{this.msgPanel.addInfo(this.TextEmpty,1000)}},invokeMessage:function(a){this.msgPanel.addMessage(this.data.sendMsg(a,this.msgPanel.faildMsg,this.msgPanel))},removeListener:function(){if(this.typeListner){clearInterval(this.typeListner)}},initTypeListener:function(){this.removeListener();var b=this,a=this.count;this.typeListner=setInterval(function(){if(++b.hits>a){b.hits=0;a*=2;if(b.data.tellyou){b.data.tellyou()}}},this.distance)},interval:500,animateCount:11,showTyping:function(){this.clearTyping();this.scrollMsg.text(this.TextTyping);this.animateTyping()},animateTyping:function(){var b=0,a=this;this.animate=setInterval(function(){if(b>a.animateCount){a.clearTyping()}else{if(b++%4==0){a.scrollMsg.text(a.TextTyping)}else{a.scrollMsg.append(".")}}},this.interval)},clearTyping:function(){if(this.animate){clearInterval(this.animate)}this.scrollMsg.text("")},onKeydown:function(a){if(a.altKey&&a.getCharCode()==83){a.preventDefault();this.sendMsg();return false}},addMessage:function(a){this.msgPanel.addMessage(a);if(!this.s){this.h=WIM.ChatTabPanel.getTabEl(this);this.s=this.h.find("span.x-tab-strip-text");this.oldColor=this.s.css("color")}if(WIM.ChatTabPanel.activeTab!=this){this.effectAlert();if(this.h.position().left<-(this.h.width()*2/3)){WIM.ChatTabPanel.alertLeft(Math.abs(this.h.offset().left))}else{if(WIM.ChatTabPanel.getScrollPos()+WIM.ChatTabPanel.getScrollArea()-(this.h.width()*2/3)<this.h[0].offsetLeft){WIM.ChatTabPanel.alertRight(this.h[0].offsetLeft+(this.h.width()*2/3))}}}TitleMgr.reg(this.s.text()+" has message!")},effectAlert:function(){if(!this.alerting){this.alerting=true;var c=this.s[0],a=this;var b=["red","yellow","blue",this.oldColor],d=400,e=5000,i=0;var f=function(){var h=setInterval(function(){if((a.alerting===false||i>=b.length*4)&&h){clearInterval(h);i=0;c.style.color=b[b.length-1];return}c.style.color=b[i++%b.length]},d)};f();this.ptimer=setInterval(f,e)}},stopAlert:function(){if(this.ptimer){clearInterval(this.ptimer)}this.ptimer=null;this.alerting=false;if(this.s){TitleMgr.unreg(this.s.text()+" has message!")}}});WIM.Win.QunChatPanel=function(){WIM.Win.QunChatPanel.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.Win.QunChatPanel,WIM.Win.ChatPanel,{TextNotice:"Notice",TextNoteEp:"add notice",TextMember:"Room Member",TextHistory:"Chat history",TextUpdate:"Update",TextUpdateSucc:"Update success\u951b\ufffd",titleCls:"x-header unselect",setData:function(a){this.data=a;if(this.list){this.list.data=this.data;this.list.refresh()}},initHeader:function(){this.header=new Ext.Toolbar({renderTo:this.left[0],cls:"cp-header"}).render();this.header.add({text:this.TextHistory,handler:this.history,scope:this})},initRight:function(){this.mgr=this.data.isOwner()||this.data.isManager();this.right=$(['<td><div class="',this.titleCls,'">',this.TextNotice,"</div><textarea ",this.mgr?"":'readOnly="readOnly"','" class="wrap" ></textarea>','<div class="note-btn"></div><div class="',this.titleCls,'">',this.TextMember,'</div><div class="wrap"></div></td>'].join("")).addClass("cp-right q-right").appendTo(this.tr);var a=this;this.notice=new Ext.form.Field({el:this.right.find("textarea")[0],maxLength:300,value:this.data.notice,emptyText:this.mgr?this.TextNoteEp:""}).render();if(this.mgr){this.barct=this.right.find(".note-btn");this.bar=new Ext.Toolbar({hidden:true,renderTo:this.barct}).render();this.bar.add({text:this.TextUpdate,handler:this.changeNotice,scope:this});this.notice.on("focus",this.showBar,this);this.notice.on("blur",function(){setTimeout(function(){a.hideBar()},2000)})}this.memTitle=this.right.find("."+this.titleCls+":last");this.warpList=this.right.find(".wrap:last").css("border","none");this.list=new Ext.tree.MemberList({data:this.data,height:"100%",renderTo:this.warpList[0]});this.list.render();this.list.on("loaded",this.chgMemTitle,this);this.list.load()},afterRender:function(){WIM.Win.QunChatPanel.superclass.afterRender.call(this);var a=this;this.right.find("[className="+this.titleCls+"]:first").css({cursor:"pointer"}).toggle(function(){a.hideBar();a.notice.el.j.slideUp()},function(){a.notice.el.j.slideDown()})},invokeMessage:function(a){this.data.sendMsg(a,function(c,b){if(c==-60){alert("\u93ae\u3125\u51e1\u741a\ue0a5\ue766\u7ec9\u8bf2\u56ad["+this.data.name+"]\u7f07\ufffd,\u93c3\u72b3\u7876\u7f01\u0445\u753b\u9471\u5a42\u3049");getWIM().g.qunPanel.delQun(this.data.id)}else{if(b){this.msgPanel.addMessage(b)}}},this)},showBar:function(){if(this.bar){var c=this.right.find("textarea"),d=c.position(),a=c.width(),b=c.height();this.barct.css({top:d.top+b-25,left:d.left+a-40});this.bar.show()}},hideBar:function(){if(this.bar){this.bar.hide()}},changeNotice:function(){this.showBar();var a=this.notice.getValue();if(a.length>0&&a!=this.data.notice){this.data.update({notice:this.notice.getValue()},function(){alert(this.TextUpdateSucc);this.hideBar()},this)}},chgMemTitle:function(){this.memTitle.html(this.TextMember+"&nbsp;&nbsp;["+this.data.onlines+"/"+this.data.total()+"]")}});WIM.UI.CollNode=Ext.extend(WIM.UI.NodeBuddy,{kickoff:function(){this.coll.kickoff(this.data,"",this.remove,this)},upgrade:function(b){var a=this.data.level;this.coll.upgrade(this.data,b.level,function(){$(this.ui.ecNode).removeClass("q-l-"+a).addClass("q-l-"+b.level)},this)},friend:function(){var a=g.isWin?g:p.g;a.setting.showAddWin(undefined,undefined,this.data.blogin,this.data.prot)}});Ext.tree.MemberList=function(){this.root=new Ext.tree.TreeNode();Ext.tree.MemberList.superclass.constructor.apply(this,arguments);this.addEvents("loaded")};Ext.extend(Ext.tree.MemberList,Ext.tree.TreePanel,{autoWidth:true,load:function(){if(this.data.loaded){this.menu=new WIM.UI.QunNodeMenu();this.data.each(this.addBuddy,this);this.fireEvent("loaded",this)}else{this.data.selectMembers(undefined,this.load,this)}},addBuddy:function(c,a){this.root.appendChild(new WIM.UI.CollNode({text:a.getName(),menu:this.menu,preIconCls:"q-l-"+a.level,coll:this.data,id:a.uid,data:a}))},refresh:function(){while(this.root.childNodes[0]){this.root.childNodes[0].remove()}this.load()}});WIM.Apply(WIM.Profile,{Text:{address:"Address",age:"age",blog:"blog",birthday:"birthday",buzPhone:"telnum",city:"city",country:"country",day:"day",desc:"description",email:"email",fax:"fax",homePhone:"home-tel",male:"sex",mobile:"phone",month:"month",name:"name",province:"province",remark:"alias",year:"year",zipcode:"zipe",pic:"picture",woman:"female",man:"male",account:"account",sign:"sign",accontInfo:"info",contact:"contact",prot:"tool",personal:"backup"}});WIM.Win.LookProfile=function(){WIM.Win.LookProfile.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.Win.LookProfile,Ext.BoxComponent,{TextUpdate:"OK",TextClose:"Close",TextUpdating:"Updating\u9225\ufe39\ufffd\ufffd",onRender:function(b,a){this.el=$("<div/>");this.initProfile(this.el);this.initFooter();this.el=this.el[0];WIM.Win.LookProfile.superclass.onRender.call(this,b,a);if(this.data.updating){this.el.mask(this.TextUpdating)}},setData:function(a){this.data=a},initProfile:function(e){var a=WIM.Profile.Text,c=this.data,b=c.profile;this.main=$(['<div class="pf-m"><h1>',a.accontInfo,"</h1><table><tr>","<td><label>",a.name,"\u951b\ufffd/label>",b.nick,"</td>","<td><label>",a.remark,"\u951b\ufffd/label>",b.remark,"</td>",'<td><img src="',Ext.BLANK_IMAGE_URL,'" title="',a.pic,'" class="pic unselect" /></td></tr><tr>',"<td><label>",a.account,"\u951b\ufffd/label>",c.blogin,"</td>","<td><label>",a.prot,"\u951b\ufffd/label>",c.getTool().name,"</td><td></td></tr><tr>",'<td colspan="3"><label class="top">',a.sign,'\u951b\ufffd/label><textarea style="height:36px;" readonly="readonly" wrap="hard" >',c.signature,"</textarea></td>","</tr></table><h1>",a.personal,"</h1><table><tr>","<td><label>",a.male,"\u951b\ufffd/label>",b.male?a.man:a.woman,"</td>","<td><label>",a.age,"\u951b\ufffd/label>-</td>","<td><label>",a.birthday,"\u951b\ufffd/label>",b.month,a.month,b.day,a.day,"</td></tr><tr>","<td><label>",a.mobile,"\u951b\ufffd/label>",b.mobile,"</td>",'<td colspan="2"><label>',a.email,"\u951b\ufffd/label>",b.email,"</td></tr><tr>",'<td colspan="3"><label>',a.blog,'\u951b\ufffd/label><a class="anchor" ',b.blog.length==0?"":'target="_blank"',' href="',b.blog.url(),'">',b.blog,"</a></td>","</tr></table><h1>",a.contact,"</h1><table><tr>","<td><label>",a.homePhone,"\u951b\ufffd/label>",b.homePhone,"</td>","<td><label>",a.buzPhone,"\u951b\ufffd/label>",b.buzPhone,"</td>","<td><label>",a.fax,"\u951b\ufffd/label>",b.fax,"</td></tr><tr>","<td><label>",a.country,"\u951b\ufffd/label>",b.country,"</td>","<td><label>",a.province,"\u951b\ufffd/label>",b.province,"</td>","<td><label>",a.city,"\u951b\ufffd/label>",b.city,"</td></tr><tr>",'<td colspan="2"><label>',a.address,"\u951b\ufffd/label>",b.address,"</td>","<td><label>",a.zipcode,"\u951b\ufffd/label>",b.zipcode,"</td></tr><tr>",'<td colspan="3"><label class="top">',a.desc,'\u951b\ufffd/label><textarea style="height:50px" wrap="hard" readonly="readonly">',b.desc,"</textarea></td></tr>","</table></div>"].join("")).prependTo(e||this.el.dom)},initFooter:function(){this.footer=new Ext.Toolbar({renderTo:this.el[0]}).render();this.footer.add("","->",{text:this.TextClose,handler:function(){WIM.ChatTabPanel.remove(this.id)},scope:this});if(this.data.view){this.footer.add({text:this.TextUpdate,handler:this.update,scope:this})}},update:function(){this.el.mask(this.TextUpdating);this.data.view(true)},refresh:function(){this.main.remove();this.initProfile();this.el.unmask()}});WIM.Win.EditProfile=function(){WIM.Win.EditProfile.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.Win.EditProfile,Ext.BoxComponent,{TextUpdate:"OK",TextClose:"Close",TextUpdating:"Updating\u9225\ufe39\ufffd\ufffd",onRender:function(b,a){this.el=$("<div/>");this.initProfile(this.el);this.initFooter();this.el=this.el[0];WIM.Win.EditProfile.superclass.onRender.call(this,b,a)},setData:function(a){this.data=a},initProfile:function(){var c=WIM.Profile.Text,h=this.data,e=h.profile;this.main=$(['<div class="pf-m"><h1>',c.accontInfo,"</h1><table><tr>","<td><label>",c.name,'\u951b\ufffd/label><span name="nick" /></td>',"<td/>",'<td><img src="',Ext.BLANK_IMAGE_URL,'" title="',c.pic,'" class="pic unselect" /></td></tr><tr>',"</tr></table><h1>",c.personal,"</h1><table><tr>","<td><label>",c.male,'\u951b\ufffd/label><em name="male" /></td>',"<td><label>",c.age,'\u951b\ufffd/label><span name="age" /></td>',"<td><label>",c.birthday,'\u951b\ufffd/label><em name="month" />',c.month,'<em name="day" />',c.day,"</td></tr><tr>","<td><label>",c.mobile,'\u951b\ufffd/label><span name="mobile" /></td>','<td colspan="2"><label>',c.email,'\u951b\ufffd/label><span name="email" /></td></tr><tr>','<td colspan="3"><label>',c.blog,'\u951b\ufffd/label><span name="blog" /></td>',"</tr></table><h1>",c.contact,"</h1><table><tr>","<td><label>",c.homePhone,'\u951b\ufffd/label><span name="homePhone" /></td>',"<td><label>",c.buzPhone,'\u951b\ufffd/label><span name="buzPhone" /></td>',"<td><label>",c.fax,'\u951b\ufffd/label><span name="fax" /></td></tr><tr>',"<td><label>",c.country,'\u951b\ufffd/label><span name="country" /></td>',"<td><label>",c.province,'\u951b\ufffd/label><span name="province" /></td>',"<td><label>",c.city,'\u951b\ufffd/label><span name="city" /></td></tr><tr>','<td colspan="2"><label>',c.address,'\u951b\ufffd/label><span name="address" /></td>',"<td><label>",c.zipcode,'\u951b\ufffd/label><span name="zipcode" /></td></tr><tr>','<td colspan="3"><label class="top">',c.desc,'\u951b\ufffd/label><textarea name="desc" wrap="hard"></textarea></td></tr>',"</table></div>"].join("")).addClass("pf-edit").prependTo(this.el);this.fields=[];var a=this;this.main.find("span").each(function(d,f){a.fields.push(new Ext.form.Field({renderTo:this,name:$(this).attr("name"),value:e[$(this).attr("name")]}).render())});this.desc=new Ext.form.Field({el:this.main.find('textarea[name="desc"]')[0],height:64,name:"desc",value:e.desc}).render();this.sex=new Ext.form.Field({renderTo:this.main.find('[name="male"]')[0],autoCreate:{tag:"select",html:'<option value="true">'+c.man+'</option><option value="false">'+c.woman+"</option>"},name:"male",value:e.male}).render();function b(j){var f='<option value="-1">&nbsp;</option>';for(var d=1;d<=j;d++){f+='<option value="'+d+'">'+d+"</option>"}return f}this.month=new Ext.form.Field({renderTo:this.main.find('[name="month"]')[0],autoCreate:{tag:"select",html:b(12)},name:"month",value:e.month}).render();this.day=new Ext.form.Field({renderTo:this.main.find('[name="day"]')[0],autoCreate:{tag:"select",html:b(31)},name:"day",value:e.day}).render();$(this.month.el.dom).change(function(){switch(parseInt($(this).val())){case -1:case 1:case 3:case 5:case 7:case 8:case 10:case 12:$(a.day.el.dom).html(b(31));break;case 2:$(a.day.el.dom).html(b(29));break;default:$(a.day.el.dom).html(b(30))}});this.fields.push(this.desc,this.sex,this.month,this.day)},initFooter:function(){this.footer=new Ext.Toolbar({renderTo:this.el[0]}).render();this.footer.add("","->",{text:this.TextClose,handler:function(){WIM.ChatTabPanel.remove(this.id)},scope:this},{text:this.TextUpdate,handler:this.update,scope:this})},TextFaild:"Updated Failed\u9225\ufe39\ufffd\ufffd",TextSucc:"Updated Success!",update:function(){this.el.mask(this.TextUpdating);var a=this,b={};$.each(this.fields,function(){b[this.name]=this.getValue()});b.month=parseInt(b.month);b.day=parseInt(b.day);this.data.updateProfile(b,function(c){if(c!=0){alert(a.TextFaild)}else{alert(a.TextSucc)}a.el.unmask()})}});WIM.Win.ManageQun=function(){WIM.Win.ManageQun.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.Win.ManageQun,Ext.BoxComponent,{TextBuddy:"My friends",TextAdded:"Added",TextAdd:"ADD->",TextDel:"<-DEL",TextInvite:"your buddy invite you",onRender:function(b,a){this.el=$("<div/>");this.initMain();this.initFooter();this.el=this.el[0];WIM.Win.ManageQun.superclass.onRender.call(this,b,a)},setData:function(a){this.data=a},afterRender:function(){WIM.Win.ManageQun.superclass.afterRender.call(this);this.main.height($(this.el.dom).parent().height()-this.footer.el.j.outerHeight(true))},initMain:function(c){this.main=$(['<div><table cellpadding="0" cellspacing="0"><tr class="title"><td class="list">',this.TextBuddy,'</td><td class="btn">&nbsp;</td><td class="list">',this.TextAdded,'</td></tr><tr><td/><td align="center" class="btns"></td><td/></tr></table></div>'].join("")).addClass("q-mgr").prependTo(this.el);this.table=this.main.find("table");this.from=new Ext.tree.BuddyPanel({data:this.list,renderTo:this.table.find("tr:last td:first").addClass("wrap")[0]});this.from.render();this.from.refresh();this.from.getBlockedGroup().ui.hide();this.from.getRequestGroup().ui.hide();this.from.eachBuddy(function(d){if(!d.data.isDefault()){d.ui.hide()}});this.data.selectMembers(null,this.hideHas,this);this.to=new Ext.tree.QunAddPanel();this.to.render(this.table.find("tr:last td:last").addClass("wrap")[0]);this.from.eachBuddy(function(d){d.events.dblclick.clearListeners();d.on("dblclick",this.addBuddy,this)},this);this.to.on("dblclick",this.removeBuddy,this);var b=this.table.find(".btns");var a=this;$("<button/>").text(this.TextAdd).click(function(){a.addBuddy(a.from.getSelectionModel().getSelectedNode())}).appendTo(b);$("<button/>").text(this.TextDel).click(function(){a.removeBuddy(a.to.getSelectionModel().getSelectedNode())}).appendTo(b)},initFooter:function(){this.footer=new Ext.Toolbar({renderTo:this.el[0]}).render();this.footer.add("","->",{text:WIM.Text.OK,handler:this.fill,scope:this},{text:WIM.Text.Cancel,handler:this.close,scope:this})},fill:function(){var a=[];this.to.all(function(b){a.push('"'+b.data.blogin+'"')});if(a.length>0){this.data.invite(a,this.TextInvite+" \u9286\ufffd"+this.data.name+"\u9286\ufffd",function(){alert(WIM.Text.Success);this.close()},this)}else{this.close()}},hideHas:function(){this.data.each(function(a,b){if(b.isFriend()){this.from.getNodeById(b.uid).hide()}},this)},close:function(){WIM.ChatTabPanel.remove(this.id)},addBuddy:function(a){if(a){a.hide();this.to.push(a.data)}},removeBuddy:function(a){if(a){var b=this.from.getNodeById(a.id);a.remove();if(b){b.show()}}}});Ext.tree.QunAddPanel=function(){this.root=new Ext.tree.TreeNode();Ext.tree.QunAddPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.tree.QunAddPanel,Ext.tree.TreePanel,{header:false,footer:false,animate:true,rootVisible:false,lines:false,border:false,split:true,autoWidth:true,useArrows:true,showAll:true,push:function(a){if(!this.getNodeById(a.uid)){var c=new WIM.UI.NodeBuddy({text:a.getName(),id:a.uid,data:a});c.events.dblclick.clearListeners();this.root.appendChild(c)}},all:function(b,a){this.root.eachChild(b,a)},refresh:function(){}});WIM.UI.QunNodeMenu=function(a){this.items=[{text:this.TextMsg,filter:"!this.node.data.isSelf() && this.node.data.isFriend()",method:"chat"},{text:this.TextAdd,filter:"!this.node.data.isSelf() && !this.node.data.isFriend()",method:"friend"},"-",{text:this.TextLook,filter:"!this.node.data.isSelf()",method:"lookPref"},{text:this.TextMgr,level:WIM.Qun.LEVEL_MANAGER,filter:"this.node.getOwnerTree().data.level >= WIM.Qun.LEVEL_MANAGER && this.node.data.level <= WIM.Qun.LEVEL_MEMBER",method:"upgrade"},{text:this.TextMem,level:WIM.Qun.LEVEL_MEMBER,filter:"this.node.getOwnerTree().data.level >= WIM.Qun.LEVEL_MANAGER && this.node.data.level == WIM.Qun.LEVEL_MANAGER",method:"upgrade"},{text:this.TextKick,filter:"this.node.getOwnerTree().data.level > this.node.data.level",method:"kickoff"}];WIM.UI.QunNodeMenu.superclass.constructor.call(this,a)};Ext.extend(WIM.UI.QunNodeMenu,WIM.UI.FilterMenu,{TextMsg:"Send Message",TextAdd:"Add Buddy",TextLook:"View Profile",TextKick:"Remove",TextMgr:"Upgrade",TextMem:"Degrade"});$(function(){var a=(function(){window.hasFocus=false;var b;$(document).mouseout(function(){if(b){clearTimeout(b)}b=setTimeout(function(){window.hasFocus=false;if(a.bfn){a.bfn.call(a.bscope||window,false)}$(document).one("mouseover",c)},3000)});function c(){if(b){clearTimeout(b)}window.hasFocus=true;if(a.ffn){a.ffn.call(a.fscope||window,false)}}return{focus:function(e,d){this.ffn=e;this.fscope=d},blur:function(e,d){this.bfn=e;this.bscope=d}}})();window.TitleMgr=(function(){var b=["\u9286\ufffd\u9286\ufffd\u9286\ufffd\u9286\ufffd\u9286\ufffd\u9286\ufffd\u9286\ufffd"];var c=document.title;a.blur(function(){if(!this.timer){var d=0;this.timer=setInterval(function(){if(b.length>1){document.title=b[d++%b.length]+" - "+c}},1000)}},this);a.focus(function(){if(this.timer){clearInterval(this.timer)}this.timer=null;document.title=c;if(WIM.ChatTabPanel&&WIM.ChatTabPanel.activeTab){TitleMgr.unreg(WIM.ChatTabPanel.getTabEl(WIM.ChatTabPanel.activeTab).text()+"\u93c9\u30e6\u79f7\u93ad\ue219\u7c21!")}},this);return{reg:function(d){if(!window.hasFocus&&$.inArray(d,b)==-1){b.unshift(d)}},unreg:function(d){b.remove(d)}}})()});WIM.FlashPlayer=function(){WIM.FlashPlayer.superclass.constructor.apply(this,arguments)};Ext.extend(WIM.FlashPlayer,Ext.BoxComponent,{title:"FLASH Game",closable:false,iconCls:"WIM_Tab_Icon_Game",flashId:"flashMovie",onRender:function(b,a){this.el=$("<div></div>").append('<iframe allowTransparency="true" scrolling="no" border="0" frameBorder="0" width="100%" src="'+this.url+'" height="100%" />');this.el=this.el[0];WIM.FlashPlayer.superclass.onRender.call(this,b,a)}});WIM.Apply({stash:function(){return;$(document).bind("contextmenu",function(){return false});$(document).keydown(this.onkeydown)},onkeydown:function(b){b=Ext.EventObject.setEvent(b);var a=b.getCharCode();if(a==8&&b.getTarget().tagName!="INPUT"&&b.getTarget().tagName!="TEXTAREA"||a==112||a==115||a==116||a==117||a==118||a==119||a==122||a==123||b.altKey&&(a==13||a==37||a==39||a==68||a==115||a==36)||b.ctrlKey&&(a==66||a==72||a==73||a==74||a==76||a==78||a==79||a==80||a==82||a==83||a==87||a==115||a==187||a==189)||b.shiftKey&&(a==121||b.getTarget().tagName=="A")||a==225){b.stopEvent();if($.browser.msie){try{window.event.returnValue=false;window.event.keyCode=0}catch(b){}}return false}else{return true}}});var p=self.opener;Ext.onReady(function(){var d;try{if(p&&!p.closed&&p.WIM&&!p.WIM.dying){T=p.WIM;var a=window.name.indexOf("_loaded")>-1?window.name.replace("_loaded",""):window.name;WIM.Bubble=p.WIM.Bubble;d=p.WIM.WinMgr.get(window.name)}else{T=WIM}}catch(c){T=WIM}WIM.K=new cookie();$(window).unload(function(){if(T.Bubble){T.Bubble.ClearTask(true)}});WIM.stash();WIM.ChatTabPanel=new Ext.ChatTabPanel();if(window.name.indexOf("_loaded")>-1){T.Bubble.recover()}if(d){d.callback()}window.name=window.name+"_loaded";checkTask();T._me.selectDomainPref(b);function b(e){var f;if(e.type==0){f=$("#WIM_Chat_Header a").text(e.brand).attr("href",e.homeUrl).attr("title",e.brand).addClass("ad adText")}else{if(e.type==1){f=$("#WIM_Chat_Header a").css("background-image","url('"+e.logoUrl+"')").attr("title",e.brand).attr("href",e.homeUrl).addClass("ad adImage")}else{if(e.type==2){$("#WIM_Chat_Header").empty();f=$('<iframe allowTransparency="true" scrolling="no" border="0" frameBorder="0" width="100%" src="'+e.iframeUrl+'" height="100%" />').addClass("ad adFrame").attr("title",e.brand).appendTo("#WIM_Chat_Header")}}}}});function checkTask(){T.Bubble.TodoTasks.each(function(a){WIM.ChatTabPanel.addTask(a)});if(T.Bubble.ShowTask){WIM.ChatTabPanel.activeTask(T.Bubble.ShowTask)}}function checkList(b,d,a,h,f){if(!window.g.rendered&&!WIM._me&&b){try{p.g.shutup()}catch(c){}Ext.get(document.body).mask("Loading data...");WIM.Init();WIM.NewUser(Ext.decode(b));if(!WIM._me){self.opener=null;self.close();return}T=WIM;WIM._me.setAllProts(Ext.decode(d).tools);WIM.Profile.alias=a;WIM._ID=h;WIM.Bubble=Bubble;WIM.Bubble.load(f||[]);new WIM.Builder({isWin:true,renderTo:$("table:first td:first")[0],maxTo:$("body"),loaded:true,callback:function(){var e=$(document);window.resizeBy(e.width()-$(window).width(),$("body").height()-$(window).height());Ext.get(document.body).unmask();window.onbeforeunload=function(){g.save();if(!WIM.Quit){if(g.msgTool.remains>0){return g.TextMsg}else{return g.TextChatting}}};self.focus()}}).load()}};
