(function(){var log = {};log.debug = function(){};var hs,s,el,fixed,cookie,cookieChecker,ie6=navigator.userAgent.indexOf("MSIE 6")>=0;var secret="";var buddyList,userList,buddyAccept,statusChanged,userSearch,buddyRequest,buddyReject,buddyRemove,addable,needRequest,buddyAddDirectly;for(var m in _zi.config){eval("var "+m+" = _zi.config['"+m+"'];")}var cookie=_zi.cookie;var cookieChecker=_zi.cookieChecker;delete _zi;var me={getName:function(){return nick||login}};var _Base=function(){};_Base.extend=function(_instance,_static){var extend=_Base.prototype.extend;_Base._prototyping=true;var proto=new this;extend.call(proto,_instance);delete _Base._prototyping;var constructor=proto.constructor;var klass=proto.constructor=function(){if(!_Base._prototyping){if(this._constructing||this.constructor==klass){this._constructing=true;constructor.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||extend).call(arguments[0],proto)}}}};klass.ancestor=this;klass.extend=this.extend;klass.prototype=proto;klass.valueOf=function(type){return(type=="object")?klass:constructor.valueOf()};extend.call(klass,_static);return klass};_Base.prototype={extend:function(source,value){if(arguments.length>1){var ancestor=this[source];if(ancestor&&(typeof value=="function")&&(!ancestor.valueOf||ancestor.valueOf()!=value.valueOf())&&/\bbase\b/.test(value)){var method=value.valueOf();value=function(){var previous=this.base||_Base.prototype.base;this.base=ancestor;var returnValue=method.apply(this,arguments);this.base=previous;return returnValue};value.valueOf=function(type){return(type=="object")?value:method}}this[source]=value}else{if(source){var extend=_Base.prototype.extend;var proto={toSource:null};var hidden=["constructor","toString","valueOf"];var i=_Base._prototyping?0:1;while(key=hidden[i++]){if(source[key]!=proto[key]){extend.call(this,key,source[key])}}for(var key in source){if(!proto[key]){extend.call(this,key,source[key])}}}}return this},base:function(){}};_Base=_Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object});JSON2=new (function(){var useHasOwn={}.hasOwnProperty?true:false;function isArray(obj){return Object.prototype.toString.call(obj)==="[object Array]"}function isDate(v){return v&&typeof v.getFullYear=="function"}var pad=function(n){return n<10?"0"+n:n};var m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};var encodeString=function(s){if(/["\\\x00-\x1f]/.test(s)){return'"'+s.replace(/([\x00-\x1f\\"])/g,function(a,b){var c=m[b];if(c){return c}c=b.charCodeAt();return"\\u00"+Math.floor(c/16).toString(16)+(c%16).toString(16)})+'"'}return'"'+s+'"'};var encodeArray=function(o){var a=["["],b,i,l=o.length,v;for(i=0;i<l;i+=1){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(v===null?"null":JSON2.encode(v));b=true}}a.push("]");return a.join("")};var encodeDate=function(o){return +o};this.encode=function(o){if(typeof o=="undefined"||o===null){return"null"}else{if(isArray(o)){return encodeArray(o)}else{if(isDate(o)){return encodeDate(o)}else{if(typeof o=="string"){return encodeString(o)}else{if(typeof o=="number"){return isFinite(o)?String(o):"null"}else{if(typeof o=="boolean"){return String(o)}else{var a=["{"],b,i,v;for(i in o){if((!useHasOwn||o.hasOwnProperty(i))&&!/base|fn|scope/.test(i)){v=o[i];switch(typeof v){case"undefined":case"function":case"unknown":break;default:if(b){a.push(",")}a.push(this.encode(i),":",v===null?"null":this.encode(v));b=true}}}a.push("}");return a.join("")}}}}}}};this.decode=function(json){return eval("("+json+")")}})();
/*
 * jQuery JavaScript Library v1.3.2
 * http://jquery.com/
 *
 * Copyright (c) 2009 John Resig
 * Dual licensed under the MIT and GPL licenses.
 * http://docs.jquery.com/License
 *
 * Date: 2009-02-19 17:34:21 -0500 (Thu, 19 Feb 2009)
 * Revision: 6246
 */
var undefined,quickExpr=/^[^<]*(<(.|\s)+>)[^>]*$|^#([\w-]+)$/,isSimple=/^.[^:#\[\.,]*$/,jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},$=jQuery;jQuery.fn=jQuery.prototype={init:function(selector,context){selector=selector||document;if(selector.nodeType){this[0]=selector;this.length=1;this.context=selector;return this}if(typeof selector==="string"){var match=quickExpr.exec(selector);if(match&&(match[1]||!context)){if(match[1]){selector=jQuery.clean([match[1]],context)}else{var elem=document.getElementById(match[3]);if(elem&&elem.id!=match[3]){return jQuery().find(selector)}var ret=jQuery(elem||[]);ret.context=document;ret.selector=selector;return ret}}else{return jQuery(context).find(selector)}}else{if(jQuery.isFunction(selector)){return jQuery(document).ready(selector)}}if(selector.selector&&selector.context){this.selector=selector.selector;this.context=selector.context}return this.setArray(jQuery.isArray(selector)?selector:jQuery.makeArray(selector))},selector:"",jquery:"1.3.2",size:function(){return this.length},get:function(num){return num===undefined?Array.prototype.slice.call(this):this[num]},pushStack:function(elems,name,selector){var ret=jQuery(elems);ret.prevObject=this;ret.context=this.context;if(name==="find"){ret.selector=this.selector+(this.selector?" ":"")+selector}else{if(name){ret.selector=this.selector+"."+name+"("+selector+")"}}return ret},setArray:function(elems){this.length=0;Array.prototype.push.apply(this,elems);return this},each:function(callback,args){return jQuery.each(this,callback,args)},index:function(elem){return jQuery.inArray(elem&&elem.jquery?elem[0]:elem,this)},attr:function(name,value,type){var options=name;if(typeof name==="string"){if(value===undefined){return this[0]&&jQuery[type||"attr"](this[0],name)}else{options={};options[name]=value}}return this.each(function(i){for(name in options){jQuery.attr(type?this.style:this,name,jQuery.prop(this,options[name],type,i,name))}})},css:function(key,value){if((key=="width"||key=="height")&&parseFloat(value)<0){value=undefined}return this.attr(key,value,"curCSS")},text:function(text){if(typeof text!=="object"&&text!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(text))}var ret="";jQuery.each(text||this,function(){jQuery.each(this.childNodes,function(){if(this.nodeType!=8){ret+=this.nodeType!=1?this.nodeValue:jQuery.fn.text([this])}})});return ret},wrapAll:function(html){if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).clone();if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){return this.each(function(){jQuery(this).contents().wrapAll(html)})},wrap:function(html){return this.each(function(){jQuery(this).wrapAll(html)})},append:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType==1){this.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,true,function(elem){if(this.nodeType==1){this.insertBefore(elem,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this)})},after:function(){return this.domManip(arguments,false,function(elem){this.parentNode.insertBefore(elem,this.nextSibling)})},end:function(){return this.prevObject||jQuery([])},push:[].push,sort:[].sort,splice:[].splice,find:function(selector){if(this.length===1){var ret=this.pushStack([],"find",selector);ret.length=0;jQuery.find(selector,this[0],ret);return ret}else{return this.pushStack(jQuery.unique(jQuery.map(this,function(elem){return jQuery.find(selector,elem)})),"find",selector)}},clone:function(events){var ret=this.map(function(){if(!jQuery.support.noCloneEvent&&!jQuery.isXMLDoc(this)){var html=this.outerHTML;if(!html){var div=this.ownerDocument.createElement("div");div.appendChild(this.cloneNode(true));html=div.innerHTML}return jQuery.clean([html.replace(/ jQuery\d+="(?:\d+|null)"/g,"").replace(/^\s*/,"")])[0]}else{return this.cloneNode(true)}});if(events===true){var orig=this.find("*").andSelf(),i=0;ret.find("*").andSelf().each(function(){if(this.nodeName!==orig[i].nodeName){return}var events=jQuery.data(orig[i],"events");for(var type in events){for(var handler in events[type]){jQuery.event.add(this,type,events[type][handler],events[type][handler].data)}}i++})}return ret},filter:function(selector){return this.pushStack(jQuery.isFunction(selector)&&jQuery.grep(this,function(elem,i){return selector.call(elem,i)})||jQuery.multiFilter(selector,jQuery.grep(this,function(elem){return elem.nodeType===1})),"filter",selector)},closest:function(selector){var pos=jQuery.expr.match.POS.test(selector)?jQuery(selector):null,closer=0;return this.map(function(){var cur=this;while(cur&&cur.ownerDocument){if(pos?pos.index(cur)>-1:jQuery(cur).is(selector)){jQuery.data(cur,"closest",closer);return cur}cur=cur.parentNode;closer++}})},not:function(selector){if(typeof selector==="string"){if(isSimple.test(selector)){return this.pushStack(jQuery.multiFilter(selector,this,true),"not",selector)}else{selector=jQuery.multiFilter(selector,this)}}var isArrayLike=selector.length&&selector[selector.length-1]!==undefined&&!selector.nodeType;return this.filter(function(){return isArrayLike?jQuery.inArray(this,selector)<0:this!=selector})},add:function(selector){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),typeof selector==="string"?jQuery(selector):jQuery.makeArray(selector))))},is:function(selector){return !!selector&&jQuery.multiFilter(selector,this).length>0},hasClass:function(selector){return !!selector&&this.is("."+selector)},val:function(value){if(value===undefined){var elem=this[0];if(elem){if(jQuery.nodeName(elem,"option")){return(elem.attributes.value||{}).specified?elem.value:elem.text}if(jQuery.nodeName(elem,"select")){var index=elem.selectedIndex,values=[],options=elem.options,one=elem.type=="select-one";if(index<0){return null}for(var i=one?index:0,max=one?index+1:options.length;i<max;i++){var option=options[i];if(option.selected){value=jQuery(option).val();if(one){return value}values.push(value)}}return values}return(elem.value||"").replace(/\r/g,"")}return undefined}if(typeof value==="number"){value+=""}return this.each(function(){if(this.nodeType!=1){return}if(jQuery.isArray(value)&&/radio|checkbox/.test(this.type)){this.checked=(jQuery.inArray(this.value,value)>=0||jQuery.inArray(this.name,value)>=0)}else{if(jQuery.nodeName(this,"select")){var values=jQuery.makeArray(value);jQuery("option",this).each(function(){this.selected=(jQuery.inArray(this.value,values)>=0||jQuery.inArray(this.text,values)>=0)});if(!values.length){this.selectedIndex=-1}}else{this.value=value}}})},html:function(value){return value===undefined?(this[0]?this[0].innerHTML.replace(/ jQuery\d+="(?:\d+|null)"/g,""):null):this.empty().append(value)},replaceWith:function(value){return this.after(value).remove()},eq:function(i){return this.slice(i,+i+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),"slice",Array.prototype.slice.call(arguments).join(","))},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(args,table,callback){if(this[0]){var fragment=(this[0].ownerDocument||this[0]).createDocumentFragment(),scripts=jQuery.clean(args,(this[0].ownerDocument||this[0]),fragment),first=fragment.firstChild;if(first){for(var i=0,l=this.length;i<l;i++){callback.call(root(this[i],first),this.length>1||i>0?fragment.cloneNode(true):fragment)}}if(scripts){jQuery.each(scripts,evalScript)}}return this;function root(elem,cur){return table&&jQuery.nodeName(elem,"table")&&jQuery.nodeName(cur,"tr")?(elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody"))):elem}}};jQuery.fn.init.prototype=jQuery.fn;function evalScript(i,elem){if(elem.src){jQuery.ajax({url:elem.src,async:false,dataType:"script"})}else{jQuery.globalEval(elem.text||elem.textContent||elem.innerHTML||"")}if(elem.parentNode){elem.parentNode.removeChild(elem)}}function now(){return +new Date}jQuery.extend=jQuery.fn.extend=function(){var target=arguments[0]||{},i=1,length=arguments.length,deep=false,options;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length==i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(var name in options){var src=target[name],copy=options[name];if(target===copy){continue}if(deep&&copy&&typeof copy==="object"&&!copy.nodeType){target[name]=jQuery.extend(deep,src||(copy.length!=null?[]:{}),copy)}else{if(copy!==undefined){target[name]=copy}}}}}return target};var exclude=/z-?index|font-?weight|opacity|zoom|line-?height/i,defaultView=document.defaultView||{},toString=Object.prototype.toString;jQuery.extend({isFunction:function(obj){return toString.call(obj)==="[object Function]"},isArray:function(obj){return toString.call(obj)==="[object Array]"},isXMLDoc:function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!=="HTML"||!!elem.ownerDocument&&jQuery.isXMLDoc(elem.ownerDocument)},globalEval:function(data){if(data&&/\S/.test(data)){var head=document.getElementsByTagName("head")[0]||document.documentElement,script=document.createElement("script");script.type="text/javascript";if(jQuery.support.scriptEval){script.appendChild(document.createTextNode(data))}else{script.text=data}head.insertBefore(script,head.firstChild);head.removeChild(script)}},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toUpperCase()==name.toUpperCase()},each:function(object,callback,args){var name,i=0,length=object.length;if(args){if(length===undefined){for(name in object){if(callback.apply(object[name],args)===false){break}}}else{for(;i<length;){if(callback.apply(object[i++],args)===false){break}}}}else{if(length===undefined){for(name in object){if(callback.call(object[name],name,object[name])===false){break}}}else{for(var value=object[0];i<length&&callback.call(value,i,value)!==false;value=object[++i]){}}}return object},prop:function(elem,value,type,i,name){if(jQuery.isFunction(value)){value=value.call(elem,i)}return typeof value==="number"&&type=="curCSS"&&!exclude.test(name)?value+"px":value},className:{add:function(elem,classNames){jQuery.each((classNames||"").split(/\s+/),function(i,className){if(elem.nodeType==1&&!jQuery.className.has(elem.className,className)){elem.className+=(elem.className?" ":"")+className}})},remove:function(elem,classNames){if(elem.nodeType==1){elem.className=classNames!==undefined?jQuery.grep(elem.className.split(/\s+/),function(className){return !jQuery.className.has(classNames,className)}).join(" "):""}},has:function(elem,className){return elem&&jQuery.inArray(className,(elem.className||elem).toString().split(/\s+/))>-1}},swap:function(elem,options,callback){var old={};for(var name in options){old[name]=elem.style[name];elem.style[name]=options[name]}callback.call(elem);for(var name in options){elem.style[name]=old[name]}},css:function(elem,name,force,extra){if(name=="width"||name=="height"){var val,props={position:"absolute",visibility:"hidden",display:"block"},which=name=="width"?["Left","Right"]:["Top","Bottom"];function getWH(){val=name=="width"?elem.offsetWidth:elem.offsetHeight;if(extra==="border"){return}jQuery.each(which,function(){if(!extra){val-=parseFloat(jQuery.curCSS(elem,"padding"+this,true))||0}if(extra==="margin"){val+=parseFloat(jQuery.curCSS(elem,"margin"+this,true))||0}else{val-=parseFloat(jQuery.curCSS(elem,"border"+this+"Width",true))||0}})}if(elem.offsetWidth!==0){getWH()}else{jQuery.swap(elem,props,getWH)}return Math.max(0,Math.round(val))}return jQuery.curCSS(elem,name,force)},curCSS:function(elem,name,force){var ret,style=elem.style;if(name=="opacity"&&!jQuery.support.opacity){ret=jQuery.attr(style,"opacity");return ret==""?"1":ret}if(name.match(/float/i)){name=styleFloat}if(!force&&style&&style[name]){ret=style[name]}else{if(defaultView.getComputedStyle){if(name.match(/float/i)){name="float"}name=name.replace(/([A-Z])/g,"-$1").toLowerCase();var computedStyle=defaultView.getComputedStyle(elem,null);if(computedStyle){ret=computedStyle.getPropertyValue(name)}if(name=="opacity"&&ret==""){ret="1"}}else{if(elem.currentStyle){var camelCase=name.replace(/\-(\w)/g,function(all,letter){return letter.toUpperCase()});ret=elem.currentStyle[name]||elem.currentStyle[camelCase];if(!/^\d+(px)?$/i.test(ret)&&/^\d/.test(ret)){var left=style.left,rsLeft=elem.runtimeStyle.left;elem.runtimeStyle.left=elem.currentStyle.left;style.left=ret||0;ret=style.pixelLeft+"px";style.left=left;elem.runtimeStyle.left=rsLeft}}}}return ret},clean:function(elems,context,fragment){context=context||document;if(typeof context.createElement==="undefined"){context=context.ownerDocument||context[0]&&context[0].ownerDocument||document}if(!fragment&&elems.length===1&&typeof elems[0]==="string"){var match=/^<(\w+)\s*\/?>$/.exec(elems[0]);if(match){return[context.createElement(match[1])]}}var ret=[],scripts=[],div=context.createElement("div");jQuery.each(elems,function(i,elem){if(typeof elem==="number"){elem+=""}if(!elem){return}if(typeof elem==="string"){elem=elem.replace(/(<(\w+)[^>]*?)\/>/g,function(all,front,tag){return tag.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?all:front+"></"+tag+">"});var tags=elem.replace(/^\s+/,"").substring(0,10).toLowerCase();var wrap=!tags.indexOf("<opt")&&[1,"<select multiple='multiple'>","</select>"]||!tags.indexOf("<leg")&&[1,"<fieldset>","</fieldset>"]||tags.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,"<table>","</table>"]||!tags.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!tags.indexOf("<td")||!tags.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||!tags.indexOf("<col")&&[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"]||!jQuery.support.htmlSerialize&&[1,"div<div>","</div>"]||[0,"",""];div.innerHTML=wrap[1]+elem+wrap[2];while(wrap[0]--){div=div.lastChild}if(!jQuery.support.tbody){var hasBody=/<tbody/i.test(elem),tbody=!tags.indexOf("<table")&&!hasBody?div.firstChild&&div.firstChild.childNodes:wrap[1]=="<table>"&&!hasBody?div.childNodes:[];for(var j=tbody.length-1;j>=0;--j){if(jQuery.nodeName(tbody[j],"tbody")&&!tbody[j].childNodes.length){tbody[j].parentNode.removeChild(tbody[j])}}}if(!jQuery.support.leadingWhitespace&&/^\s/.test(elem)){div.insertBefore(context.createTextNode(elem.match(/^\s*/)[0]),div.firstChild)}elem=jQuery.makeArray(div.childNodes)}if(elem.nodeType){ret.push(elem)}else{ret=jQuery.merge(ret,elem)}});if(fragment){for(var i=0;ret[i];i++){if(jQuery.nodeName(ret[i],"script")&&(!ret[i].type||ret[i].type.toLowerCase()==="text/javascript")){scripts.push(ret[i].parentNode?ret[i].parentNode.removeChild(ret[i]):ret[i])}else{if(ret[i].nodeType===1){ret.splice.apply(ret,[i+1,0].concat(jQuery.makeArray(ret[i].getElementsByTagName("script"))))}fragment.appendChild(ret[i])}}return scripts}return ret},attr:function(elem,name,value){if(!elem||elem.nodeType==3||elem.nodeType==8){return undefined}var notxml=!jQuery.isXMLDoc(elem),set=value!==undefined;name=notxml&&jQuery.props[name]||name;if(elem.tagName){var special=/href|src|style/.test(name);if(name=="selected"&&elem.parentNode){elem.parentNode.selectedIndex}if(name in elem&&notxml&&!special){if(set){if(name=="type"&&jQuery.nodeName(elem,"input")&&elem.parentNode){throw"type property can't be changed"}elem[name]=value}if(jQuery.nodeName(elem,"form")&&elem.getAttributeNode(name)){return elem.getAttributeNode(name).nodeValue}if(name=="tabIndex"){var attributeNode=elem.getAttributeNode("tabIndex");return attributeNode&&attributeNode.specified?attributeNode.value:elem.nodeName.match(/(button|input|object|select|textarea)/i)?0:elem.nodeName.match(/^(a|area)$/i)&&elem.href?0:undefined}return elem[name]}if(!jQuery.support.style&&notxml&&name=="style"){return jQuery.attr(elem.style,"cssText",value)}if(set){elem.setAttribute(name,""+value)}var attr=!jQuery.support.hrefNormalized&&notxml&&special?elem.getAttribute(name,2):elem.getAttribute(name);return attr===null?undefined:attr}if(!jQuery.support.opacity&&name=="opacity"){if(set){elem.zoom=1;elem.filter=(elem.filter||"").replace(/alpha\([^)]*\)/,"")+(parseInt(value)+""=="NaN"?"":"alpha(opacity="+value*100+")")}return elem.filter&&elem.filter.indexOf("opacity=")>=0?(parseFloat(elem.filter.match(/opacity=([^)]*)/)[1])/100)+"":""}name=name.replace(/-([a-z])/ig,function(all,letter){return letter.toUpperCase()});if(set){elem[name]=value}return elem[name]},trim:function(text){return(text||"").replace(/^\s+|\s+$/g,"")},makeArray:function(array){var ret=[];if(array!=null){var i=array.length;if(i==null||typeof array==="string"||jQuery.isFunction(array)||array.setInterval){ret[0]=array}else{while(i){ret[--i]=array[i]}}}return ret},inArray:function(elem,array){for(var i=0,length=array.length;i<length;i++){if(array[i]===elem){return i}}return -1},merge:function(first,second){var i=0,elem,pos=first.length;if(!jQuery.support.getAll){while((elem=second[i++])!=null){if(elem.nodeType!=8){first[pos++]=elem}}}else{while((elem=second[i++])!=null){first[pos++]=elem}}return first},unique:function(array){var ret=[],done={};try{for(var i=0,length=array.length;i<length;i++){var id=jQuery.data(array[i]);if(!done[id]){done[id]=true;ret.push(array[i])}}}catch(e){ret=array}return ret},grep:function(elems,callback,inv){var ret=[];for(var i=0,length=elems.length;i<length;i++){if(!inv!=!callback(elems[i],i)){ret.push(elems[i])}}return ret},map:function(elems,callback){var ret=[];for(var i=0,length=elems.length;i<length;i++){var value=callback(elems[i],i);if(value!=null){ret[ret.length]=value}}return ret.concat.apply([],ret)}});var userAgent=navigator.userAgent.toLowerCase();jQuery.browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)};jQuery.each({parent:function(elem){return elem.parentNode},parents:function(elem){return jQuery.dir(elem,"parentNode")},next:function(elem){return jQuery.nth(elem,2,"nextSibling")},prev:function(elem){return jQuery.nth(elem,2,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},siblings:function(elem){return jQuery.sibling(elem.parentNode.firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.makeArray(elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(selector){var ret=jQuery.map(this,fn);if(selector&&typeof selector=="string"){ret=jQuery.multiFilter(selector,ret)}return this.pushStack(jQuery.unique(ret),name,selector)}});jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var ret=[],insert=jQuery(selector);for(var i=0,l=insert.length;i<l;i++){var elems=(i>0?this.clone(true):this).get();jQuery.fn[original].apply(jQuery(insert[i]),elems);ret=ret.concat(elems)}return this.pushStack(ret,name,selector)}});jQuery.each({removeAttr:function(name){jQuery.attr(this,name,"");if(this.nodeType==1){this.removeAttribute(name)}},addClass:function(classNames){jQuery.className.add(this,classNames)},removeClass:function(classNames){jQuery.className.remove(this,classNames)},toggleClass:function(classNames,state){if(typeof state!=="boolean"){state=!jQuery.className.has(this,classNames)}jQuery.className[state?"add":"remove"](this,classNames)},remove:function(selector){if(!selector||jQuery.filter(selector,[this]).length){jQuery("*",this).add([this]).each(function(){jQuery.event.remove(this);jQuery.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){jQuery(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(name,fn){jQuery.fn[name]=function(){return this.each(fn,arguments)}});function num(elem,prop){return elem[0]&&parseInt(jQuery.curCSS(elem[0],prop,true),10)||0}var expando="jQuery"+now(),uuid=0,windowData={};jQuery.extend({cache:{},data:function(elem,name,data){elem=elem==window?windowData:elem;var id=elem[expando];if(!id){id=elem[expando]=++uuid}if(name&&!jQuery.cache[id]){jQuery.cache[id]={}}if(data!==undefined){jQuery.cache[id][name]=data}return name?jQuery.cache[id][name]:id},removeData:function(elem,name){elem=elem==window?windowData:elem;var id=elem[expando];if(name){if(jQuery.cache[id]){delete jQuery.cache[id][name];name="";for(name in jQuery.cache[id]){break}if(!name){jQuery.removeData(elem)}}}else{try{delete elem[expando]}catch(e){if(elem.removeAttribute){elem.removeAttribute(expando)}}delete jQuery.cache[id]}},queue:function(elem,type,data){if(elem){type=(type||"fx")+"queue";var q=jQuery.data(elem,type);if(!q||jQuery.isArray(data)){q=jQuery.data(elem,type,jQuery.makeArray(data))}else{if(data){q.push(data)}}}return q},dequeue:function(elem,type){var queue=jQuery.queue(elem,type),fn=queue.shift();if(!type||type==="fx"){fn=queue[0]}if(fn!==undefined){fn.call(elem)}}});jQuery.fn.extend({data:function(key,value){var parts=key.split(".");parts[1]=parts[1]?"."+parts[1]:"";if(value===undefined){var data=this.triggerHandler("getData"+parts[1]+"!",[parts[0]]);if(data===undefined&&this.length){data=jQuery.data(this[0],key)}return data===undefined&&parts[1]?this.data(parts[0]):data}else{return this.trigger("setData"+parts[1]+"!",[parts[0],value]).each(function(){jQuery.data(this,key,value)})}},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})},queue:function(type,data){if(typeof type!=="string"){data=type;type="fx"}if(data===undefined){return jQuery.queue(this[0],type)}return this.each(function(){var queue=jQuery.queue(this,type,data);if(type=="fx"&&queue.length==1){queue[0].call(this)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})}});
/*
 * Sizzle CSS Selector Engine - v0.9.3
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
(function(){var chunker=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,done=0,toString=Object.prototype.toString;var Sizzle=function(selector,context,results,seed){results=results||[];context=context||document;if(context.nodeType!==1&&context.nodeType!==9){return[]}if(!selector||typeof selector!=="string"){return results}var parts=[],m,set,checkSet,check,mode,extra,prune=true;chunker.lastIndex=0;while((m=chunker.exec(selector))!==null){parts.push(m[1]);if(m[2]){extra=RegExp.rightContext;break}}if(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context)}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector]){selector+=parts.shift()}set=posProcess(selector,set)}}}else{var ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&context.parentNode?context.parentNode:context,isXML(context));set=Sizzle.filter(ret.expr,ret.set);if(parts.length>0){checkSet=makeArray(set)}else{prune=false}while(parts.length){var cur=parts.pop(),pop=cur;if(!Expr.relative[cur]){cur=""}else{pop=parts.pop()}if(pop==null){pop=context}Expr.relative[cur](checkSet,pop,isXML(context))}}if(!checkSet){checkSet=set}if(!checkSet){throw"Syntax error, unrecognized expression: "+(cur||selector)}if(toString.call(checkSet)==="[object Array]"){if(!prune){results.push.apply(results,checkSet)}else{if(context.nodeType===1){for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&contains(context,checkSet[i]))){results.push(set[i])}}}else{for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i])}}}}}else{makeArray(checkSet,results)}if(extra){Sizzle(extra,context,results,seed);if(sortOrder){hasDuplicate=false;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1)}}}}}return results};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set)};Sizzle.find=function(expr,context,isXML){var set,match;if(!expr){return[]}for(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.match[type].exec(expr))){var left=RegExp.leftContext;if(left.substr(left.length-1)!=="\\"){match[1]=(match[1]||"").replace(/\\/g,"");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],"");break}}}}if(!set){set=context.getElementsByTagName("*")}return{set:set,expr:expr}};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.match[type].exec(expr))!=null){var filter=Expr.filter[type],found,item;anyFound=false;if(curLoop==result){result=[]}if(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true}else{if(match===true){continue}}}if(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true}else{curLoop[i]=false}}else{if(pass){result.push(item);anyFound=true}}}}}if(found!==undefined){if(!inplace){curLoop=result}expr=expr.replace(Expr.match[type],"");if(!anyFound){return[]}break}}}if(expr==old){if(anyFound==null){throw"Syntax error, unrecognized expression: "+expr}else{break}}old=expr}return curLoop};var Expr=Sizzle.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(elem){return elem.getAttribute("href")}},relative:{"+":function(checkSet,part,isXML){var isPartStr=typeof part==="string",isTag=isPartStr&&!/\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag&&!isXML){part=part.toUpperCase()}for(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}checkSet[i]=isPartStrNotTag||elem&&elem.nodeName===part?elem||false:elem===part}}if(isPartStrNotTag){Sizzle.filter(part,checkSet,true)}},">":function(checkSet,part,isXML){var isPartStr=typeof part==="string";if(isPartStr&&!/\W/.test(part)){part=isXML?part:part.toUpperCase();for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName===part?parent:false}}}else{for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part}}if(isPartStr){Sizzle.filter(part,checkSet,true)}}},"":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(!part.match(/\W/)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("parentNode",part,doneName,checkSet,nodeCheck,isXML)},"~":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(typeof part==="string"&&!part.match(/\W/)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck}checkFn("previousSibling",part,doneName,checkSet,nodeCheck,isXML)}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[]}},NAME:function(match,context,isXML){if(typeof context.getElementsByName!=="undefined"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute("name")===match[1]){ret.push(results[i])}}return ret.length===0?null:ret}},TAG:function(match,context){return context.getElementsByTagName(match[1])}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=" "+match[1].replace(/\\/g,"")+" ";if(isXML){return match}for(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(" "+elem.className+" ").indexOf(match)>=0)){if(!inplace){result.push(elem)}}else{if(inplace){curLoop[i]=false}}}}return false},ID:function(match){return match[1].replace(/\\/g,"")},TAG:function(match,curLoop){for(var i=0;curLoop[i]===false;i++){}return curLoop[i]&&isXML(curLoop[i])?match[1]:match[1].toUpperCase()},CHILD:function(match){if(match[1]=="nth"){var test=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(match[2]=="even"&&"2n"||match[2]=="odd"&&"2n+1"||!/\D/.test(match[2])&&"0n+"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0}match[0]=done++;return match},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\/g,"");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name]}if(match[2]==="~="){match[4]=" "+match[4]+" "}return match},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]==="not"){if(match[3].match(chunker).length>1||/^\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop)}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret)}return false}}else{if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true}}return match},POS:function(match){match.unshift(true);return match}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!=="hidden"},disabled:function(elem){return elem.disabled===true},checked:function(elem){return elem.checked===true},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true},parent:function(elem){return !!elem.firstChild},empty:function(elem){return !elem.firstChild},has:function(elem,i,match){return !!Sizzle(match[3],elem).length},header:function(elem){return/h\d/i.test(elem.nodeName)},text:function(elem){return"text"===elem.type},radio:function(elem){return"radio"===elem.type},checkbox:function(elem){return"checkbox"===elem.type},file:function(elem){return"file"===elem.type},password:function(elem){return"password"===elem.type},submit:function(elem){return"submit"===elem.type},image:function(elem){return"image"===elem.type},reset:function(elem){return"reset"===elem.type},button:function(elem){return"button"===elem.type||elem.nodeName.toUpperCase()==="BUTTON"},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName)}},setFilters:{first:function(elem,i){return i===0},last:function(elem,i,match,array){return i===array.length-1},even:function(elem,i){return i%2===0},odd:function(elem,i){return i%2===1},lt:function(elem,i,match){return i<match[3]-0},gt:function(elem,i,match){return i>match[3]-0},nth:function(elem,i,match){return match[3]-0==i},eq:function(elem,i,match){return match[3]-0==i}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array)}else{if(name==="contains"){return(elem.textContent||elem.innerText||"").indexOf(match[3])>=0}else{if(name==="not"){var not=match[3];for(var i=0,l=not.length;i<l;i++){if(not[i]===elem){return false}}return true}}}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case"only":case"first":while(node=node.previousSibling){if(node.nodeType===1){return false}}if(type=="first"){return true}node=elem;case"last":while(node=node.nextSibling){if(node.nodeType===1){return false}}return true;case"nth":var first=match[2],last=match[3];if(first==1&&last==0){return true}var doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count}}parent.sizcache=doneName}var diff=elem.nodeIndex-last;if(first==0){return diff==0}else{return(diff%first==0&&diff/first>=0)}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute("id")===match},TAG:function(elem,match){return(match==="*"&&elem.nodeType===1)||elem.nodeName===match},CLASS:function(elem,match){return(" "+(elem.className||elem.getAttribute("class"))+" ").indexOf(match)>-1},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+"",type=match[2],check=match[4];return result==null?type==="!=":type==="="?value===check:type==="*="?value.indexOf(check)>=0:type==="~="?(" "+value+" ").indexOf(check)>=0:!check?value&&result!==false:type==="!="?value!=check:type==="^="?value.indexOf(check)===0:type==="$="?value.substr(value.length-check.length)===check:type==="|="?value===check||value.substr(0,check.length+1)===check+"-":false},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array)}}}};var origPOS=Expr.match.POS;for(var type in Expr.match){Expr.match[type]=RegExp(Expr.match[type].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var makeArray=function(array,results){array=Array.prototype.slice.call(array);if(results){results.push.apply(results,array);return results}return array};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(e){makeArray=function(array,results){var ret=results||[];if(toString.call(array)==="[object Array]"){Array.prototype.push.apply(ret,array)}else{if(typeof array.length==="number"){for(var i=0,l=array.length;i<l;i++){ret.push(array[i])}}else{for(var i=0;array[i];i++){ret.push(array[i])}}}return ret}}var sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true}return ret}}else{if("sourceIndex" in document.documentElement){sortOrder=function(a,b){var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true}return ret}}else{if(document.createRange){sortOrder=function(a,b){var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.selectNode(a);aRange.collapse(true);bRange.selectNode(b);bRange.collapse(true);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true}return ret}}}}(function(){var form=document.createElement("form"),id="script"+(new Date).getTime();form.innerHTML="<input name='"+id+"'/>";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(!!document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!=="undefined"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id").nodeValue===match[1]?[m]:undefined:[]}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!=="undefined"&&elem.getAttributeNode("id");return elem.nodeType===1&&node&&node.nodeValue===match}}root.removeChild(form)})();(function(){var div=document.createElement("div");div.appendChild(document.createComment(""));if(div.getElementsByTagName("*").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]==="*"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i])}}results=tmp}return results}}div.innerHTML="<a href='#'></a>";if(div.firstChild&&typeof div.firstChild.getAttribute!=="undefined"&&div.firstChild.getAttribute("href")!=="#"){Expr.attrHandle.href=function(elem){return elem.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var oldSizzle=Sizzle,div=document.createElement("div");div.innerHTML="<p class='TEST'></p>";if(div.querySelectorAll&&div.querySelectorAll(".TEST").length===0){return}Sizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!isXML(context)){try{return makeArray(context.querySelectorAll(query),extra)}catch(e){}}return oldSizzle(query,context,extra,seed)};Sizzle.find=oldSizzle.find;Sizzle.filter=oldSizzle.filter;Sizzle.selectors=oldSizzle.selectors;Sizzle.matches=oldSizzle.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var div=document.createElement("div");div.innerHTML="<div class='test e'></div><div class='test'></div>";if(div.getElementsByClassName("e").length===0){return}div.lastChild.className="e";if(div.getElementsByClassName("e").length===1){return}Expr.order.splice(1,0,"CLASS");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!=="undefined"&&!isXML){return context.getElementsByClassName(match[1])}}})()}function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i}if(elem.nodeName===cur){match=elem;break}elem=elem[dir]}checkSet[i]=match}}}function dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir=="previousSibling"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i}elem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break}if(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i}if(typeof cur!=="string"){if(elem===cur){match=true;break}}else{if(Sizzle.filter(cur,[elem]).length>0){match=elem;break}}}elem=elem[dir]}checkSet[i]=match}}}var contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16}:function(a,b){return a!==b&&(a.contains?a.contains(b):true)};var isXML=function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!=="HTML"||!!elem.ownerDocument&&isXML(elem.ownerDocument)};var posProcess=function(selector,context){var tmpSet=[],later="",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,"")}selector=Expr.relative[selector]?selector+"*":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet)}return Sizzle.filter(later,tmpSet)};jQuery.find=Sizzle;jQuery.filter=Sizzle.filter;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.filters;Sizzle.selectors.filters.hidden=function(elem){return elem.offsetWidth===0||elem.offsetHeight===0};Sizzle.selectors.filters.visible=function(elem){return elem.offsetWidth>0||elem.offsetHeight>0};Sizzle.selectors.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};jQuery.multiFilter=function(expr,elems,not){if(not){expr=":not("+expr+")"}return Sizzle.matches(expr,elems)};jQuery.dir=function(elem,dir){var matched=[],cur=elem[dir];while(cur&&cur!=document){if(cur.nodeType==1){matched.push(cur)}cur=cur[dir]}return matched};jQuery.nth=function(cur,result,dir,elem){result=result||1;var num=0;for(;cur;cur=cur[dir]){if(cur.nodeType==1&&++num==result){break}}return cur};jQuery.sibling=function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType==1&&n!=elem){r.push(n)}}return r};return})();jQuery.event={add:function(elem,types,handler,data){if(elem.nodeType==3||elem.nodeType==8){return}if(elem.setInterval&&elem!=window){elem=window}if(!handler.guid){handler.guid=this.guid++}if(data!==undefined){var fn=handler;handler=this.proxy(fn);handler.data=data}var events=jQuery.data(elem,"events")||jQuery.data(elem,"events",{}),handle=jQuery.data(elem,"handle")||jQuery.data(elem,"handle",function(){return typeof jQuery!=="undefined"&&!jQuery.event.triggered?jQuery.event.handle.apply(arguments.callee.elem,arguments):undefined});handle.elem=elem;jQuery.each(types.split(/\s+/),function(index,type){var namespaces=type.split(".");type=namespaces.shift();handler.type=namespaces.slice().sort().join(".");var handlers=events[type];if(jQuery.event.specialAll[type]){jQuery.event.specialAll[type].setup.call(elem,data,namespaces)}if(!handlers){handlers=events[type]={};if(!jQuery.event.special[type]||jQuery.event.special[type].setup.call(elem,data,namespaces)===false){if(elem.addEventListener){elem.addEventListener(type,handle,false)}else{if(elem.attachEvent){elem.attachEvent("on"+type,handle)}}}}handlers[handler.guid]=handler;jQuery.event.global[type]=true});elem=null},guid:1,global:{},remove:function(elem,types,handler){if(elem.nodeType==3||elem.nodeType==8){return}var events=jQuery.data(elem,"events"),ret,index;if(events){if(types===undefined||(typeof types==="string"&&types.charAt(0)==".")){for(var type in events){this.remove(elem,type+(types||""))}}else{if(types.type){handler=types.handler;types=types.type}jQuery.each(types.split(/\s+/),function(index,type){var namespaces=type.split(".");type=namespaces.shift();var namespace=RegExp("(^|\\.)"+namespaces.slice().sort().join(".*\\.")+"(\\.|$)");if(events[type]){if(handler){delete events[type][handler.guid]}else{for(var handle in events[type]){if(namespace.test(events[type][handle].type)){delete events[type][handle]}}}if(jQuery.event.specialAll[type]){jQuery.event.specialAll[type].teardown.call(elem,namespaces)}for(ret in events[type]){break}if(!ret){if(!jQuery.event.special[type]||jQuery.event.special[type].teardown.call(elem,namespaces)===false){if(elem.removeEventListener){elem.removeEventListener(type,jQuery.data(elem,"handle"),false)}else{if(elem.detachEvent){elem.detachEvent("on"+type,jQuery.data(elem,"handle"))}}}ret=null;delete events[type]}}})}for(ret in events){break}if(!ret){var handle=jQuery.data(elem,"handle");if(handle){handle.elem=null}jQuery.removeData(elem,"events");jQuery.removeData(elem,"handle")}}},trigger:function(event,data,elem,bubbling){var type=event.type||event;if(!bubbling){event=typeof event==="object"?event[expando]?event:jQuery.extend(jQuery.Event(type),event):jQuery.Event(type);if(type.indexOf("!")>=0){event.type=type=type.slice(0,-1);event.exclusive=true}if(!elem){event.stopPropagation();if(this.global[type]){jQuery.each(jQuery.cache,function(){if(this.events&&this.events[type]){jQuery.event.trigger(event,data,this.handle.elem)}})}}if(!elem||elem.nodeType==3||elem.nodeType==8){return undefined}event.result=undefined;event.target=elem;data=jQuery.makeArray(data);data.unshift(event)}event.currentTarget=elem;var handle=jQuery.data(elem,"handle");if(handle){handle.apply(elem,data)}if((!elem[type]||(jQuery.nodeName(elem,"a")&&type=="click"))&&elem["on"+type]&&elem["on"+type].apply(elem,data)===false){event.result=false}if(!bubbling&&elem[type]&&!event.isDefaultPrevented()&&!(jQuery.nodeName(elem,"a")&&type=="click")){this.triggered=true;try{elem[type]()}catch(e){}}this.triggered=false;if(!event.isPropagationStopped()){var parent=elem.parentNode||elem.ownerDocument;if(parent){jQuery.event.trigger(event,data,parent,true)}}},handle:function(event){var all,handlers;event=arguments[0]=jQuery.event.fix(event||window.event);event.currentTarget=this;var namespaces=event.type.split(".");event.type=namespaces.shift();all=!namespaces.length&&!event.exclusive;var namespace=RegExp("(^|\\.)"+namespaces.slice().sort().join(".*\\.")+"(\\.|$)");handlers=(jQuery.data(this,"events")||{})[event.type];for(var j in handlers){var handler=handlers[j];if(all||namespace.test(handler.type)){event.handler=handler;event.data=handler.data;var ret=handler.apply(this,arguments);if(ret!==undefined){event.result=ret;if(ret===false){event.preventDefault();event.stopPropagation()}}if(event.isImmediatePropagationStopped()){break}}}},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(event){if(event[expando]){return event}var originalEvent=event;event=jQuery.Event(originalEvent);for(var i=this.props.length,prop;i;){prop=this.props[--i];event[prop]=originalEvent[prop]}if(!event.target){event.target=event.srcElement||document}if(event.target.nodeType==3){event.target=event.target.parentNode}if(!event.relatedTarget&&event.fromElement){event.relatedTarget=event.fromElement==event.target?event.toElement:event.fromElement}if(event.pageX==null&&event.clientX!=null){var doc=document.documentElement,body=document.body;event.pageX=event.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc.clientLeft||0);event.pageY=event.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc.clientTop||0)}if(!event.which&&((event.charCode||event.charCode===0)?event.charCode:event.keyCode)){event.which=event.charCode||event.keyCode}if(!event.metaKey&&event.ctrlKey){event.metaKey=event.ctrlKey}if(!event.which&&event.button){event.which=(event.button&1?1:(event.button&2?3:(event.button&4?2:0)))}return event},proxy:function(fn,proxy){proxy=proxy||function(){return fn.apply(this,arguments)};proxy.guid=fn.guid=fn.guid||proxy.guid||this.guid++;return proxy},special:{ready:{setup:bindReady,teardown:function(){}}},specialAll:{live:{setup:function(selector,namespaces){jQuery.event.add(this,namespaces[0],liveHandler)},teardown:function(namespaces){if(namespaces.length){var remove=0,name=RegExp("(^|\\.)"+namespaces[0]+"(\\.|$)");jQuery.each((jQuery.data(this,"events").live||{}),function(){if(name.test(this.type)){remove++}});if(remove<1){jQuery.event.remove(this,namespaces[0],liveHandler)}}}}}};jQuery.Event=function(src){if(!this.preventDefault){return new jQuery.Event(src)}if(src&&src.type){this.originalEvent=src;this.type=src.type}else{this.type=src}this.timeStamp=now();this[expando]=true};function returnFalse(){return false}function returnTrue(){return true}jQuery.Event.prototype={preventDefault:function(){this.isDefaultPrevented=returnTrue;var e=this.originalEvent;if(!e){return}if(e.preventDefault){e.preventDefault()}e.returnValue=false},stopPropagation:function(){this.isPropagationStopped=returnTrue;var e=this.originalEvent;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()},isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse};var withinElement=function(event){var parent=event.relatedTarget;while(parent&&parent!=this){try{parent=parent.parentNode}catch(e){parent=this}}if(parent!=this){event.type=event.data;jQuery.event.handle.apply(this,arguments)}};jQuery.each({mouseover:"mouseenter",mouseout:"mouseleave"},function(orig,fix){jQuery.event.special[fix]={setup:function(){jQuery.event.add(this,orig,withinElement,fix)},teardown:function(){jQuery.event.remove(this,orig,withinElement)}}});jQuery.fn.extend({bind:function(type,data,fn){return type=="unload"?this.one(type,data,fn):this.each(function(){jQuery.event.add(this,type,fn||data,fn&&data)})},one:function(type,data,fn){var one=jQuery.event.proxy(fn||data,function(event){jQuery(this).unbind(event,one);return(fn||data).apply(this,arguments)});return this.each(function(){jQuery.event.add(this,type,one,fn&&data)})},unbind:function(type,fn){return this.each(function(){jQuery.event.remove(this,type,fn)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){if(this[0]){var event=jQuery.Event(type);event.preventDefault();event.stopPropagation();jQuery.event.trigger(event,data,this[0]);return event.result}},toggle:function(fn){var args=arguments,i=1;while(i<args.length){jQuery.event.proxy(fn,args[i++])}return this.click(jQuery.event.proxy(fn,function(event){this.lastToggle=(this.lastToggle||0)%i;event.preventDefault();return args[this.lastToggle++].apply(this,arguments)||false}))},hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut)},ready:function(fn){bindReady();if(jQuery.isReady){fn.call(document,jQuery)}else{jQuery.readyList.push(fn)}return this},live:function(type,fn){var proxy=jQuery.event.proxy(fn);proxy.guid+=this.selector+type;jQuery(document).bind(liveConvert(type,this.selector),this.selector,proxy);return this},die:function(type,fn){jQuery(document).unbind(liveConvert(type,this.selector),fn?{guid:fn.guid+this.selector+type}:null);return this}});function liveHandler(event){var check=RegExp("(^|\\.)"+event.type+"(\\.|$)"),stop=true,elems=[];jQuery.each(jQuery.data(this,"events").live||[],function(i,fn){if(check.test(fn.type)){var elem=jQuery(event.target).closest(fn.data)[0];if(elem){elems.push({elem:elem,fn:fn})}}});elems.sort(function(a,b){return jQuery.data(a.elem,"closest")-jQuery.data(b.elem,"closest")});jQuery.each(elems,function(){if(this.fn.call(this.elem,event,this.fn.data)===false){return(stop=false)}});return stop}function liveConvert(type,selector){return["live",type,selector.replace(/\./g,"`").replace(/ /g,"|")].join(".")}jQuery.extend({isReady:false,readyList:[],ready:function(){if(!jQuery.isReady){jQuery.isReady=true;if(jQuery.readyList){jQuery.each(jQuery.readyList,function(){this.call(document,jQuery)});jQuery.readyList=null}jQuery(document).triggerHandler("ready")}}});var readyBound=false;function bindReady(){if(readyBound){return}readyBound=true;if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){document.removeEventListener("DOMContentLoaded",arguments.callee,false);jQuery.ready()},false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",arguments.callee);jQuery.ready()}});if(document.documentElement.doScroll&&window==window.top){(function(){if(jQuery.isReady){return}try{document.documentElement.doScroll("left")}catch(error){setTimeout(arguments.callee,0);return}jQuery.ready()})()}}}jQuery.event.add(window,"load",jQuery.ready)}jQuery.each(("blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error").split(","),function(i,name){jQuery.fn[name]=function(fn){return fn?this.bind(name,fn):this.trigger(name)}});jQuery(window).bind("unload",function(){for(var id in jQuery.cache){if(id!=1&&jQuery.cache[id].handle){jQuery.event.remove(jQuery.cache[id].handle.elem)}}});(function(){jQuery.support={};var root=document.documentElement,script=document.createElement("script"),div=document.createElement("div"),id="script"+(new Date).getTime();div.style.display="none";div.innerHTML='   <link/><table></table><a href="/a" style="color:red;float:left;opacity:.5;">a</a><select><option>text</option></select><object><param/></object>';var all=div.getElementsByTagName("*"),a=div.getElementsByTagName("a")[0];if(!all||!all.length||!a){return}jQuery.support={leadingWhitespace:div.firstChild.nodeType==3,tbody:!div.getElementsByTagName("tbody").length,objectAll:!!div.getElementsByTagName("object")[0].getElementsByTagName("*").length,htmlSerialize:!!div.getElementsByTagName("link").length,style:/red/.test(a.getAttribute("style")),hrefNormalized:a.getAttribute("href")==="/a",opacity:a.style.opacity==="0.5",cssFloat:!!a.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};script.type="text/javascript";try{script.appendChild(document.createTextNode("window."+id+"=1;"))}catch(e){}root.insertBefore(script,root.firstChild);if(window[id]){jQuery.support.scriptEval=true;delete window[id]}root.removeChild(script);if(div.attachEvent&&div.fireEvent){div.attachEvent("onclick",function(){jQuery.support.noCloneEvent=false;div.detachEvent("onclick",arguments.callee)});div.cloneNode(true).fireEvent("onclick")}jQuery(function(){var div=document.createElement("div");div.style.width=div.style.paddingLeft="1px";document.body.appendChild(div);jQuery.boxModel=jQuery.support.boxModel=div.offsetWidth===2;document.body.removeChild(div).style.display="none"})})();var styleFloat=jQuery.support.cssFloat?"cssFloat":"styleFloat";jQuery.props={"for":"htmlFor","class":"className","float":styleFloat,cssFloat:styleFloat,styleFloat:styleFloat,readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",tabindex:"tabIndex"};var jsc=now();var elemdisplay={},timerId,fxAttrs=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];function genFx(type,num){var obj={};jQuery.each(fxAttrs.concat.apply([],fxAttrs.slice(0,num)),function(){obj[this]=type});return obj}jQuery.fn.extend({show:function(speed,callback){if(speed){return this.animate(genFx("show",3),speed,callback)}else{for(var i=0,l=this.length;i<l;i++){var old=jQuery.data(this[i],"olddisplay");this[i].style.display=old||"";if(jQuery.css(this[i],"display")==="none"){var tagName=this[i].tagName,display;if(elemdisplay[tagName]){display=elemdisplay[tagName]}else{var elem=jQuery("<"+tagName+" />").appendTo("body");display=elem.css("display");if(display==="none"){display="block"}elem.remove();elemdisplay[tagName]=display}jQuery.data(this[i],"olddisplay",display)}}for(var i=0,l=this.length;i<l;i++){this[i].style.display=jQuery.data(this[i],"olddisplay")||""}return this}},hide:function(speed,callback){if(speed){return this.animate(genFx("hide",3),speed,callback)}else{for(var i=0,l=this.length;i<l;i++){var old=jQuery.data(this[i],"olddisplay");if(!old&&old!=="none"){jQuery.data(this[i],"olddisplay",jQuery.css(this[i],"display"))}}for(var i=0,l=this.length;i<l;i++){this[i].style.display="none"}return this}},_toggle:jQuery.fn.toggle,toggle:function(fn,fn2){var bool=typeof fn==="boolean";return jQuery.isFunction(fn)&&jQuery.isFunction(fn2)?this._toggle.apply(this,arguments):fn==null||bool?this.each(function(){var state=bool?fn:jQuery(this).is(":hidden");jQuery(this)[state?"show":"hide"]()}):this.animate(genFx("toggle",3),fn,fn2)},fadeTo:function(speed,to,callback){return this.animate({opacity:to},speed,callback)},animate:function(prop,speed,easing,callback){var optall=jQuery.speed(speed,easing,callback);return this[optall.queue===false?"each":"queue"](function(){var opt=jQuery.extend({},optall),p,hidden=this.nodeType==1&&jQuery(this).is(":hidden"),self=this;for(p in prop){if(prop[p]=="hide"&&hidden||prop[p]=="show"&&!hidden){return opt.complete.call(this)}if((p=="height"||p=="width")&&this.style){opt.display=jQuery.css(this,"display");opt.overflow=this.style.overflow}}if(opt.overflow!=null){this.style.overflow="hidden"}opt.curAnim=jQuery.extend({},prop);jQuery.each(prop,function(name,val){var e=new jQuery.fx(self,opt,name);if(/toggle|show|hide/.test(val)){e[val=="toggle"?hidden?"show":"hide":val](prop)}else{var parts=val.toString().match(/^([+-]=)?([\d+-.]+)(.*)$/),start=e.cur(true)||0;if(parts){var end=parseFloat(parts[2]),unit=parts[3]||"px";if(unit!="px"){self.style[name]=(end||1)+unit;start=((end||1)/e.cur(true))*start;self.style[name]=start+unit}if(parts[1]){end=((parts[1]=="-="?-1:1)*end)+start}e.custom(start,end,unit)}else{e.custom(start,val,"")}}});return true})},stop:function(clearQueue,gotoEnd){var timers=jQuery.timers;if(clearQueue){this.queue([])}this.each(function(){for(var i=timers.length-1;i>=0;i--){if(timers[i].elem==this){if(gotoEnd){timers[i](true)}timers.splice(i,1)}}});if(!gotoEnd){this.dequeue()}return this}});jQuery.each({slideDown:genFx("show",1),slideUp:genFx("hide",1),slideToggle:genFx("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(name,props){jQuery.fn[name]=function(speed,callback){return this.animate(props,speed,callback)}});jQuery.extend({speed:function(speed,easing,fn){var opt=typeof speed==="object"?speed:{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:jQuery.fx.speeds[opt.duration]||jQuery.fx.speeds._default;opt.old=opt.complete;opt.complete=function(){if(opt.queue!==false){jQuery(this).dequeue()}if(jQuery.isFunction(opt.old)){opt.old.call(this)}};return opt},easing:{linear:function(p,n,firstNum,diff){return firstNum+diff*p},swing:function(p,n,firstNum,diff){return((-Math.cos(p*Math.PI)/2)+0.5)*diff+firstNum}},timers:[],fx:function(elem,options,prop){this.options=options;this.elem=elem;this.prop=prop;if(!options.orig){options.orig={}}}});jQuery.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(jQuery.fx.step[this.prop]||jQuery.fx.step._default)(this);if((this.prop=="height"||this.prop=="width")&&this.elem.style){this.elem.style.display="block"}},cur:function(force){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var r=parseFloat(jQuery.css(this.elem,this.prop,force));return r&&r>-10000?r:parseFloat(jQuery.curCSS(this.elem,this.prop))||0},custom:function(from,to,unit){this.startTime=now();this.start=from;this.end=to;this.unit=unit||this.unit||"px";this.now=this.start;this.pos=this.state=0;var self=this;function t(gotoEnd){return self.step(gotoEnd)}t.elem=this.elem;if(t()&&jQuery.timers.push(t)&&!timerId){timerId=setInterval(function(){var timers=jQuery.timers;for(var i=0;i<timers.length;i++){if(!timers[i]()){timers.splice(i--,1)}}if(!timers.length){clearInterval(timerId);timerId=undefined}},13)}},show:function(){this.options.orig[this.prop]=jQuery.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop=="width"||this.prop=="height"?1:0,this.cur());jQuery(this.elem).show()},hide:function(){this.options.orig[this.prop]=jQuery.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(gotoEnd){var t=now();if(gotoEnd||t>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var done=true;for(var i in this.options.curAnim){if(this.options.curAnim[i]!==true){done=false}}if(done){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(jQuery.css(this.elem,"display")=="none"){this.elem.style.display="block"}}if(this.options.hide){jQuery(this.elem).hide()}if(this.options.hide||this.options.show){for(var p in this.options.curAnim){jQuery.attr(this.elem.style,p,this.options.orig[p])}}this.options.complete.call(this.elem)}return false}else{var n=t-this.startTime;this.state=n/this.options.duration;this.pos=jQuery.easing[this.options.easing||(jQuery.easing.swing?"swing":"linear")](this.state,n,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};jQuery.extend(jQuery.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(fx){jQuery.attr(fx.elem.style,"opacity",fx.now)},_default:function(fx){if(fx.elem.style&&fx.elem.style[fx.prop]!=null){fx.elem.style[fx.prop]=fx.now+fx.unit}else{fx.elem[fx.prop]=fx.now}}}});if(document.documentElement.getBoundingClientRect){jQuery.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return jQuery.offset.bodyOffset(this[0])}var box=this[0].getBoundingClientRect(),doc=this[0].ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+(self.pageYOffset||jQuery.boxModel&&docElem.scrollTop||body.scrollTop)-clientTop,left=box.left+(self.pageXOffset||jQuery.boxModel&&docElem.scrollLeft||body.scrollLeft)-clientLeft;return{top:top,left:left}}}else{jQuery.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return jQuery.offset.bodyOffset(this[0])}jQuery.offset.initialized||jQuery.offset.initialize();var elem=this[0],offsetParent=elem.offsetParent,prevOffsetParent=elem,doc=elem.ownerDocument,computedStyle,docElem=doc.documentElement,body=doc.body,defaultView=doc.defaultView,prevComputedStyle=defaultView.getComputedStyle(elem,null),top=elem.offsetTop,left=elem.offsetLeft;while((elem=elem.parentNode)&&elem!==body&&elem!==docElem){computedStyle=defaultView.getComputedStyle(elem,null);top-=elem.scrollTop,left-=elem.scrollLeft;if(elem===offsetParent){top+=elem.offsetTop,left+=elem.offsetLeft;if(jQuery.offset.doesNotAddBorder&&!(jQuery.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(elem.tagName))){top+=parseInt(computedStyle.borderTopWidth,10)||0,left+=parseInt(computedStyle.borderLeftWidth,10)||0}prevOffsetParent=offsetParent,offsetParent=elem.offsetParent}if(jQuery.offset.subtractsBorderForOverflowNotVisible&&computedStyle.overflow!=="visible"){top+=parseInt(computedStyle.borderTopWidth,10)||0,left+=parseInt(computedStyle.borderLeftWidth,10)||0}prevComputedStyle=computedStyle}if(prevComputedStyle.position==="relative"||prevComputedStyle.position==="static"){top+=body.offsetTop,left+=body.offsetLeft}if(prevComputedStyle.position==="fixed"){top+=Math.max(docElem.scrollTop,body.scrollTop),left+=Math.max(docElem.scrollLeft,body.scrollLeft)}return{top:top,left:left}}}jQuery.offset={initialize:function(){if(this.initialized){return}var body=document.body,container=document.createElement("div"),innerDiv,checkDiv,table,td,rules,prop,bodyMarginTop=body.style.marginTop,html='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';rules={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(prop in rules){container.style[prop]=rules[prop]}container.innerHTML=html;body.insertBefore(container,body.firstChild);innerDiv=container.firstChild,checkDiv=innerDiv.firstChild,td=innerDiv.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(checkDiv.offsetTop!==5);this.doesAddBorderForTableAndCells=(td.offsetTop===5);innerDiv.style.overflow="hidden",innerDiv.style.position="relative";this.subtractsBorderForOverflowNotVisible=(checkDiv.offsetTop===-5);body.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=(body.offsetTop===0);body.style.marginTop=bodyMarginTop;body.removeChild(container);this.initialized=true},bodyOffset:function(body){jQuery.offset.initialized||jQuery.offset.initialize();var top=body.offsetTop,left=body.offsetLeft;if(jQuery.offset.doesNotIncludeMarginInBodyOffset){top+=parseInt(jQuery.curCSS(body,"marginTop",true),10)||0,left+=parseInt(jQuery.curCSS(body,"marginLeft",true),10)||0}return{top:top,left:left}}};jQuery.fn.extend({position:function(){var left=0,top=0,results;if(this[0]){var offsetParent=this.offsetParent(),offset=this.offset(),parentOffset=/^body|html$/i.test(offsetParent[0].tagName)?{top:0,left:0}:offsetParent.offset();offset.top-=num(this,"marginTop");offset.left-=num(this,"marginLeft");parentOffset.top+=num(offsetParent,"borderTopWidth");parentOffset.left+=num(offsetParent,"borderLeftWidth");results={top:offset.top-parentOffset.top,left:offset.left-parentOffset.left}}return results},offsetParent:function(){var offsetParent=this[0].offsetParent||document.body;while(offsetParent&&(!/^body|html$/i.test(offsetParent.tagName)&&jQuery.css(offsetParent,"position")=="static")){offsetParent=offsetParent.offsetParent}return jQuery(offsetParent)}});jQuery.each(["Left","Top"],function(i,name){var method="scroll"+name;jQuery.fn[method]=function(val){if(!this[0]){return null}return val!==undefined?this.each(function(){this==window||this==document?window.scrollTo(!i?val:jQuery(window).scrollLeft(),i?val:jQuery(window).scrollTop()):this[method]=val}):this[0]==window||this[0]==document?self[i?"pageYOffset":"pageXOffset"]||jQuery.boxModel&&document.documentElement[method]||document.body[method]:this[0][method]}});jQuery.each(["Height","Width"],function(i,name){var tl=i?"Left":"Top",br=i?"Right":"Bottom",lower=name.toLowerCase();jQuery.fn["inner"+name]=function(){return this[0]?jQuery.css(this[0],lower,false,"padding"):null};jQuery.fn["outer"+name]=function(margin){return this[0]?jQuery.css(this[0],lower,false,margin?"margin":"border"):null};var type=name.toLowerCase();jQuery.fn[type]=function(size){return this[0]==window?document.compatMode=="CSS1Compat"&&document.documentElement["client"+name]||document.body["client"+name]:this[0]==document?Math.max(document.documentElement["client"+name],document.body["scroll"+name],document.documentElement["scroll"+name],document.body["offset"+name],document.documentElement["offset"+name]):size===undefined?(this.length?jQuery.css(this[0],type):null):this.css(type,typeof size==="string"?size:size+"px")}});jQuery.fn.extend({hoverClass:function(cls){return this.each(function(){$(this).hover(function(){$(this).addClass(cls)},function(){$(this).removeClass(cls)})})},hold:function(type,fn,scope,data){return this.each(function(){$(this).bind(type,function(){if(data){Array.prototype.push.call(arguments,data)}fn.apply(scope||window,arguments)})})},adjustPos:function(fixLeft,fixTop){return this.each(function(){var t=$(this);if(fixLeft){var left=parseInt(t.css("left")),w=t.outerWidth(),winW=$.windowWidth(),adjLeft=winW-w-25;if(left>adjLeft){left=adjLeft}if(left<5){left=5}t.css("left",left)}if(fixTop){var top=parseInt(t.css("top")),h=t.outerHeight(),winH=$.windowHeight(),adjTop=winH-h-5;if(top>adjTop){top=adjTop}if(top<5){top=5}t.css("top",top)}})},bgiframe:function(s){if($.browser.msie&&/6.0/.test(navigator.userAgent)){s=$.extend({top:false,left:false,width:"auto",height:"auto",opacity:true,src:"javascript:false;"},s||{});var html='<iframe class="bgiframe" scrolling="no" frameborder="0" tabindex="-1" src="'+s.src+"\"style=\"display:block;position:absolute;z-index:-1;filter:Alpha(Opacity='0');"+(s.top?"top:expression(((parseInt(this.parentNode.currentStyle.borderTopWidth)||0)*-1)+'px');":"")+(s.left?"left:expression(((parseInt(this.parentNode.currentStyle.borderLeftWidth)||0)*-1)+'px');":"")+"width:expression(this.parentNode.offsetWidth+'px');height:expression(this.parentNode.offsetHeight+'px');\"/>";return this.each(function(){if($("> iframe.bgiframe",this).length==0){this.insertBefore(document.createElement(html),this.firstChild)}})}return this}});jQuery.extend({leftPad:function(val,size,ch){val=new String(val);ch=ch||" ";while(val.length<size){val=ch+val}return val},windowHeight:function(){var de=document.documentElement;return self.innerHeight||(de&&de.clientHeight)||document.body.clientHeight},windowWidth:function(){var de=document.documentElement;return self.innerWidth||(de&&de.clientWidth)||document.body.clientWidth}});jQuery.Event.prototype.stopEvent=function(){this.preventDefault();this.stopPropagation()};var initHostService=function(opt){function service(){$.extend(this,opt);return this.init()}service.prototype={urlFrame:"embed.html",TextError:"\u64CD\u4F5C\u5931\u6548 : \u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5931\u8D25,\u8BF7\u5237\u65B0\u9875\u9762!",init:function(){var matchs=/(\S+:\/\/\S+\/)/.exec(this.reqUrl);if(matchs){this.urlFrame=matchs[1]+this.urlFrame}var arrMethods=["buddyAccept","statusChanged","buddyAddDirectly","userList","buddyList","userSearch","buddyReject","buddyRemove","buddyRequest"];var _self=this;for(var i=0;i<arrMethods.length;i++){(function(){var m=arrMethods[i]+"";_self[m]=function(o,fn,scope){o=o||{};var data={m:m,domain:_self.domain};for(var name in o){data[name]=o[name]}var rep="";if(m=="buddyList"){rep=[{login:"1",nick:"Tom",status:"OFFLINE",sign:"famale, 28"},{login:"2",nick:"Lily",status:"OFFLINE",sign:"famale, 43"},{login:"3",nick:"Chunk",status:"OFFLINE",sign:"male, 22"},{login:"4",nick:"Dan",status:"OFFLINE",sign:"male, 32"}]}else{if(m=="userList"){rep=[{login:"8",nick:"Bart",status:"ONLINE",sign:"male, 32"},{login:"5",nick:"Kate",status:"ONLINE",sign:"famale, 45"},{login:"6",nick:"Jim",status:"ONLINE",sign:"male, 23"},{login:"7",nick:"Lulu",status:"ONLINE",sign:"famale, 16"}]}}fn=fn||o.fn;scope=scope||o.scope||window;if(fn){setTimeout(function(){fn.call(scope,rep)},100)}}})()}return this},checkFrame:function(){var _self=this,timer=setInterval(function(){try{if(_self.iframe.contentWindow&&_self.iframe.contentWindow.xhrPool){clearInterval(timer);_self.onConnect(_self.iframe.contentWindow)}}catch(e){}},13)},onConnect:function(win){this.xhrPool=win.xhrPool;this.xhrPool.setUrl(this.reqUrl);var ie6=navigator.userAgent.indexOf("MSIE 6")>=0;var _self=this;this.xhrPool.handleError=function(errortext){if(errortext=="ajaxerror"||errortext=="authfail"||(!ie6&&errortext=="timeout")){_self.xhrPool.stop()}};if(this.fn){this.fn()}},start:function(fn){if(!this.iframe){this.iframe=$("<iframe width='0' height='0' allowTransparency='true' scrolling='no' border='0' frameBorder='0' frameBorder='0'/>").hide().attr("src",this.urlFrame+"?domain="+this.domain).appendTo(document.body)[0]}this.fn=fn;if(fn){fn()}},error:function(){},failed:function(){this.stop()},stop:function(){if(this.xhrPool){this.xhrPool.stop()}},destroy:function(){this.stop();this.iframe.parentNode.removeChild(this.iframe)}};return hs=new service()};var initService=function(opt){function service(){$.extend(this,opt);return this.init()}service.prototype={TextError:"\u64CD\u4F5C\u5931\u6548 : \u4E0E\u670D\u52A1\u5668\u901A\u4FE1\u5931\u8D25,\u8BF7\u91CD\u65B0\u767B\u5F55!",init:function(){try{document.domain=this.domain}catch(e){}var arrMethods=["buddyAccept","buddyAdd","buddyDel","buddyReject","buddyReq","buddyUpload","domainSelect","getOnlineLogins","getOnlineNum","getSecret","submitFeedback","whisper","echo"];var _self=this;for(var i=0;i<arrMethods.length;i++){(function(){var m=arrMethods[i]+"";_self[m]=function(o){o=o||{};if($.isArray(o)){o={params:o}}var data={m:m};if(o.params&&o.params.length>0){data.p=o.params}if(o.fn){setTimeout(function(){o.fn.call(o.scope||window,"test")},100)}}})()}this.urlFrame="chicken.html";return this},checkFrame:function(){var _self=this;var timer=setInterval(function(){try{if(_self.iframe.contentWindow&&_self.iframe.contentWindow.xhrPool){clearInterval(timer);_self.onConnect(_self.iframe.contentWindow)}}catch(e){}},13)},onConnect:function(win){this.xhrPool=win.xhrPool;this.xhrPool.setUrl("http://"+this.alias+"/post/zibar");var ie6=navigator.userAgent.indexOf("MSIE 6")>=0;var _self=this;this.xhrPool.handleError=function(errortext){if(errortext=="ajaxerror"||errortext=="authfail"||(!ie6&&errortext=="timeout")){_self.xhrPool.stop()}};if(this.fn){this.fn()}},start:function(fn){if(!this.iframe){this.iframe=$("<iframe width='0' height='0' allowTransparency='true' scrolling='no' border='0' frameBorder='0' frameBorder='0'/>").hide().attr("src",this.urlFrame+"?domain="+this.domain).appendTo(document.body)[0]}this.fn=fn;this.checkFrame()},error:function(){return},failed:function(){this.stop()},stop:function(){if(this.xhrPool){this.xhrPool.stop()}},destroy:function(){this.stop();if(this.iframe){this.iframe.parentNode.removeChild(this.iframe)}}};s=new service();return s};var Event=function(obj,name){this.name=name;this.obj=obj;this.listeners=[]};Event.prototype={addListener:function(fn,scope,options){scope=scope||this.obj;if(!this.isListening(fn,scope)){var l=this.createListener(fn,scope,options);if(!this.firing){this.listeners.push(l)}else{this.listeners=this.listeners.slice(0);this.listeners.push(l)}}},createListener:function(fn,scope,o){return{fn:fn,scope:scope||this.obj,options:o||{},fireFn:fn}},findListener:function(fn,scope){scope=scope||this.obj;var ls=this.listeners;for(var i=0,len=ls.length;i<len;i++){var l=ls[i];if(l.fn==fn&&l.scope==scope){return i}}return -1},isListening:function(fn,scope){return this.findListener(fn,scope)!=-1},removeListener:function(fn,scope){var index;if((index=this.findListener(fn,scope))!=-1){if(!this.firing){this.listeners.splice(index,1)}else{this.listeners=this.listeners.slice(0);this.listeners.splice(index,1)}return true}return false},clearListeners:function(){this.listeners.length=0},fire:function(){var ls=this.listeners,scope,len=ls.length;if(len>0){this.firing=true;var args=Array.prototype.slice.call(arguments,0);for(var i=0;i<len;i++){var l=ls[i];if(l.fireFn.apply(l.scope||this.obj||window,arguments)===false){this.firing=false;return false}}this.firing=false}return true}};var Observable=_Base.extend({constructor:function(){this.events={};this.base(arguments[0]);if(this.listeners){this.on(this.listeners);delete this.listeners}},fireEvent:function(){if(this.eventsSuspended!==true){var ce=this.getEvent(arguments[0]);if(ce&&ce.fire){return ce.fire.apply(ce,Array.prototype.slice.call(arguments,1))}}return true},getEvent:function(name){return this.events[name.toLowerCase()]},on:function(eventName,fn,scope,o){if(typeof eventName=="object"){o=eventName;for(var e in o){if(typeof o[e]=="function"){this.on(e,o[e],o.scope,o)}else{this.on(e,o[e].fn,o[e].scope,o[e])}}return this}o=(!o||typeof o=="boolean")?{}:o;eventName=(eventName+"").toLowerCase();var ce=this.events[eventName]||true;if(typeof ce=="boolean"){ce=new Event(this,eventName);this.events[eventName]=ce}ce.addListener(fn,scope,o);return this},un:function(eventName,fn,scope){var ce=this.events[eventName.toLowerCase()];if(typeof ce=="object"){ce.removeListener(fn,scope)}return this},purgeListeners:function(){for(var evt in this.events){if(typeof this.events[evt]=="object"){this.events[evt].clearListeners()}}},addEvents:function(o){for(var i=0,a=arguments,v;v=a[i];i++){if(!this.events[a[i]]){this.events[a[i]]=true}}},hasListener:function(eventName){var e=this.events[eventName];return typeof e=="object"&&e.listeners.length>0},suspendEvents:function(){this.eventsSuspended=true},resumeEvents:function(){this.eventsSuspended=false}});var ieStorage=function(){function _createStorageNode(){var n=document.createElement("div");n.style.display="none";n.style.behavior="url(#default#userData)";document.body.appendChild(n);return n}var node=_createStorageNode(),MAX_KEYSIZE=500,tar="t_",MAX_LEN=500;node.expires=new Date((+new Date())+1000*60*60*8).toGMTString();function _set(key,value){try{var total=parseInt(value.length/MAX_LEN)+1;for(var i=0;i<total;i++){node.setAttribute(tar+i,value.substr(i*MAX_LEN,MAX_LEN))}node.removeAttribute(tar+i);node.save(key);return true}catch(e){return false}}function _get(key){try{node.load(key);var str="",i=0,temp;do{if(temp){str+=temp}temp=node.getAttribute(tar+i++)}while(temp);return str}catch(e){return null}}function _remove(key){try{node.load(key);var i=0;while(node.getAttribute(tar+i)){node.removeAttribute(tar+i);i++}node.save(key);return true}catch(e){return false}}return{read:_get,write:_set,remove:_remove}};window.Fookie=(function(){var swf,swfUrl="",swfId="fookie_swf_"+Math.round(Math.random()*100),_self;function _waitSwfReady(){swf=document[swfId]||window[swfId];if(!swf){setTimeout(arguments.callee,13)}}function _writeSwf(){var a=['<object id="',swfId,'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,19,0" width="1" height="1">','<param name="movie" value="',swfUrl,'" />','<param name="quality" value="high" />','<param name="allowscriptaccess" value="always" />','<embed name="',swfId,'" src="',swfUrl,'" allowscriptaccess="always" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="1" height="1"></embed>',"</object>"].join(""),ct=document.createElement("div"),style={display:"block",border:"none",width:"1px",height:"1px",overflow:"hidden"};for(var m in style){ct.style[m]=style[m]}(function(){if(document.body){document.body.insertBefore(ct,document.body.firstChild);ct.innerHTML=a;_waitSwfReady()}else{setTimeout(arguments.callee,13)}})()}function doAction(method,config,name,value){if(!swf||!swf[method]){return}config=config||{};var a=config.application||_self.application,p=config.path||_self.path,e=config.expires||_self.expires,s=config.secure?true:_self.secure;var args=[];if(name!==undefined){args.push(name)}if(value!==undefined){args.push(value)}args.push(a,p);method=="write"?args.push(e,s):args.push(s);try{return swf[method].apply(swf,args)}catch(e){}}return{application:"fookie_data",path:"/",expires:1000,secure:false,init:function(url,config){_self=this;if(url){swfUrl=url}for(var c in config||{}){this[c]=config[c]}var methods={read:1,write:2,remove:1,clear:0};for(var m in methods){(function(){var name=m,num=methods[name];_self[name]=function(){var args=Array.prototype.slice.call(arguments,0,num);args.unshift(name,arguments[num]);return doAction.apply(null,args)}})()}_writeSwf();return this},imReady:function(){this.onready()}}})();var html5Storage=function(){var d=document.domain;var obj=window.localStorage||window.globalStorage[d];function _set(key,value){try{obj.setItem(key,value);return true}catch(e){return false}return true}function _get(key){try{var rep=obj.getItem(key);if(rep!=null){return rep.value||rep}}catch(e){}return null}function _remove(key){try{obj.removeItem(key);return true}catch(e){return false}}return{read:_get,write:_set,remove:_remove}};var Store=(function(){var obj=(window.globalStorage||window.localStorage)?new html5Storage():navigator.userAgent.toUpperCase().indexOf("MSIE")>-1?new ieStorage():Fookie.init("js/1.0/fookie.swf");return{read:function(){try{var v=obj.read.apply(this,arguments);if(v){return this.decode(v)}}catch(e){}return null},write:function(key,value){try{return obj.write(key,this.encode(value))}catch(e){return false}},remove:function(){try{return obj.remove.apply(this,arguments)}catch(e){return false}},decode:function(v){return v},encode:function(v){return v}}})();var EventType={TYPE_AUTH_FAIL:1,TYPE_BUDDY_ACCEPT:53,TYPE_BUDDY_ADD:50,TYPE_BUDDY_DEL:51,TYPE_BUDDY_REJECT:54,TYPE_BUDDY_REQ:52,TYPE_CONNECT_FROM_OTHER:10,TYPE_DOMAIN_DISABLED:12,TYPE_ERROR:0,TYPE_MSG_WHISPER:30,TYPE_PROT_LOGIN_SUCCESS:100,TYPE_REDIRECT_TO:11,TYPE_SIGNATURE_CHANGE:22,TYPE_STATUS_CHANGE:20,TYPE_TYPING:21,TYPE_CLICKCT:701,TYPE_DELCT:702,TYPE_ADDCT:703,TYPE_ADDNODE:710,TYPE_DELNODE:711,TYPE_SENDMSG:720,TYPE_PANELCLP:731};var slaver=Observable.extend({retry:13,first:true,distance:1000,separator:"$_$",list:[],operation:"operation_"+login,keyMsg:"msg_"+login,counter:-1,maxInval:15000,suspend:true,todolist:[],constructor:function(){this.base();this.id=+new Date()},init:function(){for(var m in EventType){this.addEvents(EventType[m])}var _self=this;this.timer=setInterval(function(){if(!_self.suspend){_self.read()}},this.distance);this.read();setInterval(function(){if(_self.todolist.length>0){var opt=Store.read(_self.operation)||"";Store.write(_self.operation,opt+_self.separator+_self.todolist.join(_self.separator));_self.todolist.length=0}},100);return this},start:function(){this.suspend=false},read:function(){var msgs=Store.read(this.keyMsg);if(msgs){var arr=msgs.split(this.separator),hash={};for(var i=0;i<arr.length;i++){if(arr[i].length>0){this.handle(arr[i])}}delete hash}return this},stop:function(){this.suspend=true},failed:function(){},handle:function(evt){evt=typeof evt=="string"?JSON2.decode(evt):evt;evt=typeof evt=="string"?JSON2.decode(evt):evt;if(evt.type!==undefined&&evt.talker!=this.id&&evt.counter>this.counter){this.counter=evt.counter;this.fireEvent(evt.type+"",evt)}},createEvent:function(type,msg,item){return{type:type,talker:this.id,item:item,msg:msg}},report:function(type,msg,item){this.todolist.push(JSON2.encode(this.createEvent(type,msg,item||"")));return this}});var Slave=new slaver();var Master=(function(){var timer,distance=1000,retry=13,data,url="",separator="$_$",operation="operation_"+login,keyMsg="msg_"+login,counter=1,list=[],hash={},expire=[],MAX_Count=300,invalidTime=3000000;function splitMsg(str){var arr=str.split(separator);list=[];for(var i=0;i<arr.length;i++){if(arr[i].length>0){list.push(arr[i]);counter=Math.max(counter,parseEvent(arr[i]).counter)}}counter++}function parseEvent(evt){evt=typeof evt=="string"?JSON2.decode(evt):evt;evt=typeof evt=="string"?JSON2.decode(evt):evt;return evt}function proceeEvent(evt){evt.counter=counter++;evt.clientTime=+new Date();return JSON2.encode(evt)}function analyseEvent(event){list.push(proceeEvent(event))}function serialEvent(){return list.join(separator)}return{first:true,init:function(opt){$.extend(this,opt||{});log.debug("init master ");data={first:this.first,secret:this.secret,token:this.token,guid:this.domain+"/"+this.login};this.urlFrame="horse.html";url="poll";if(timer){clearInterval(timer)}timer=setInterval(function(){var opt=Store.read(operation);if(opt&&typeof opt=="string"){Store.remove(operation);var arr=opt.split(separator);if(arr.length>0){for(var i=0;i<arr.length;i++){if(arr[i].length>0){Master.accept(arr[i])}}}}},distance);var msgs=Store.read(keyMsg);if(msgs){splitMsg(msgs)}return this},setCounter:function(n){counter=n},checkFrame:function(){var _self=this;_self.timer=setInterval(function(){try{if(_self.iframe.contentWindow&&_self.iframe.contentWindow.l){clearInterval(_self.timer);_self.listener=_self.iframe.contentWindow.l;_self.listener.init(_self,url,data).start()}}catch(e){}},13)},check:function(evt){try{return(evt.type==EventType.TYPE_CONNECT_FROM_OTHER||evt.type==EventType.TYPE_DOMAIN_DISABLED||evt.type==EventType.TYPE_AUTH_FAIL)}catch(e){}},start:function(fn){this.running=true;this.fn=fn;if(!this.iframe){this.iframe=$("<iframe width='0' height='0' allowTransparency='true' scrolling='no' border='0' frameBorder='0' frameBorder='0'/>").hide().attr("src",this.urlFrame+"?domain="+this.domain).appendTo(document.body)[0]}if(fn){fn()}},stop:function(){if(this.listener){this.listener.stop();this.running=false}},error:function(){},destroy:function(){},failed:function(){if(this.running){this.stop();if(this.onFailed){this.onFailed()}}},accept:function(event){if(event){if(event.from){event.from=event.from.replace(/^.*?\/{1}/i,"")}var newarr=[];$.each(list,function(i,n){var match=/["]?clientTime["]?:(\d*)/.exec(n);if(match&&(+new Date())-parseInt(match[1])<invalidTime){newarr.push(n)}});list=newarr;event=parseEvent(event);if(event.type!=EventType.TYPE_BUDDY_REQ&&event.type!=EventType.TYPE_BUDDY_ADD&&event.type!=EventType.TYPE_BUDDY_ACCEPT&&event.type!=EventType.TYPE_BUDDY_REJECT&&event.type!=EventType.TYPE_AUTH_FAIL&&event.type!=EventType.TYPE_ADDNODE&&event.type!=EventType.TYPE_CONNECT_FROM_OTHER){analyseEvent(event);Store.write(keyMsg,serialEvent())}Slave.handle(event)}},createSnapShot:function(){}}})();var component=Observable.extend({defer:false,constructor:function(){this.base(arguments[0]);if(this.dom){this.el=$(this.dom)}if(!this.defer){this.init()}this.addEvents("render","contextmenu")},init:function(){if(this.cls){this.el.addClass(this.cls)}if(this.style){this.el.css(this.style)}this.render();if(this.width){this.el.width(this.width)}if(this.tip){this.el.attr("title",this.tip)}if(this.id){this.setId(this.id)}this.el.hold("contextmenu",this.onContextmenu,this);this.ct=this.el.parent();if(this.ctCls){this.ct.addClass(this.ctCls)}if(this.menu){this.on("contextmenu",this.showMenu,this)}},onContextmenu:function(e){this.fireEvent("contextmenu",e,this)},showMenu:function(e,data){e.preventDefault();if(this.menu.constructor!=menu){this.menu=new menu(this.menu)}this.menu.data=data;this.menu.showAt(e.clientX,e.clientY);return false},render:function(){if(this.renderTo){this.el.appendTo(this.renderTo);this.rendered=true;this.fireEvent("render",this);delete this.renderTo}return this},show:function(){this.hidden=false;if(this.el){this.el.show()}return this},hide:function(){this.hidden=true;if(this.el){this.el.hide()}return this},remove:function(){if(this.el){this.el.remove()}if(this.menu&&this.menu.constructor==menu){this.menu.remove()}},setId:function(id){if(this.el){this.el.data("zmid",this.id=id)}},getId:function(){return this.id}});var toolbar=component.extend({constructor:function(){this.items=[];this.base(arguments[0]);this.addEvents("close","clickItem","invalidItem","active")},init:function(){el=this.el=$(['<div class="z-w-wrap">','<div class="z-w-ct">','<table cellspacing="0" cellpadding="0" class="z-w-table">','<tr class="z-w-tr">',"</tr>","</table>","</div>","</div>"].join("")).appendTo("body").bgiframe();var iframe=this.el.find("> iframe.bgiframe");iframe.width(this.el.find(".z-w-ct").width());this.tr=this.el.find("tr.z-w-tr");var ie6=navigator.userAgent.indexOf("MSIE 6")>=0;if(ie6||this.el.css("position")!="fixed"){fixed=false;this.el.addClass("z-w-wrap-fix");function windowHeight(){var de=document.documentElement;return self.innerHeight||(de&&de.clientHeight)||document.body.clientHeight}var _self=this;function fixTop(close){el.css("top",Math.max($(window).scrollTop(),$(document.body).scrollTop())+windowHeight()-el.outerHeight()-1).show();iframe.width(el.find(".z-w-ct").width());if(close==true){_self.closeAll()}}fixTop();var showTimer;function fixPosition(close){el.hide();if(showTimer){clearTimeout(showTimer)}showTimer=setTimeout(function(){fixTop(close)},500)}$(window).scroll(fixPosition).resize(function(){fixPosition(true)});$(document).resize(function(){fixPosition(true)})}else{fixed=true}return this},closeAll:function(){for(var i=0;i<this.items.length;i++){var n=this.items[i];if(n.isActived()&&n.panel){n.panel.collapse()}}},add:function(){var a=arguments,l=a.length;for(var i=0;i<l;i++){var el=a[i];if(typeof el=="string"){if(el=="-"){this.addSeparator()}else{if(el=="->"){this.addFill()}else{this.addText(el)}}}else{if(el.tagName){this.addElement(el)}else{if(typeof el=="object"){this.addButton(el)}}}}return this},addText:function(text,after){return this.addItem({title:text},after)},addElement:function(dom,after){return this.addItem({dom:dom},after)},addSeparator:function(after){return this.addElement($('<span class="z-w-sep"/>'),after)},addFill:function(after){var item=this.addElement($("<div/>").html("&nbsp;"),after);item.fill=true;item.ct.width("100%");return item},addItem:function(config,after){var has;if(config.id&&(has=this.get(config.id))){return has}var td,oldWidth=this.tr.width();if(after){var i=this.indexOf(after);if(i<0){i=this.items.length-1}td=$("<td>").insertAfter(this.tr.find("td:eq("+i+")"))}else{td=$("<td>").appendTo(this.tr)}config=$.extend({toolbar:this,renderTo:td},config);var item=new toolbar.item(config);item.on("active",this.onItemActive,this).on("close",function(item){this.fireEvent("close",item,this)},this).on("click",function(e,item){this.fireEvent("clickItem",e,item)},this).on("invalid",function(e,item){this.fireEvent("invalidItem",e,item)},this);this.items.push(item);var total=0;for(var i=0;i<this.items.length;i++){var n=this.items[i];if(!n.fill){total+=n.ct.outerWidth()}}var diff=total-oldWidth;if(diff>0){for(var i=0;i<this.items.length&&diff>0;i++){var n=this.items[i];if(n.closeable){diff-=n.ct.outerWidth();n.close()}}}return item},addButton:function(config,after){config=$.extend({width:125,activeable:true},config);return this.addItem(config,after)},get:function(o){if(typeof o=="number"){return this.items[o]}else{if(typeof o=="string"){for(var i=0;i<this.items.length;i++){if(this.items[i].getId()==o){return this.items[i]}}}}if(o.constructor==toolbar.item){return o}else{return null}},indexOf:function(o){if(typeof o=="number"){return o>=this.items.length?-1:o}else{if(typeof o=="string"){for(var i=0;i<this.items.length;i++){if(this.items[i].getId()==o){return i}}}else{return $.inArray(o,this.items)}}return -1},removeItem:function(o){var i=this.indexOf(o);if(i>-1){o=this.items[i];o.ct.remove();this.items.splice(i,1);for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.isActived()&&n.panel&&n.panel.expanded){if($.browser.safari&&n.panel.collapseable){n.panel.collapse()}else{this.onItemActive(n)}}}}return this},onItemActive:function(item){var left=item.panel.el.position().left,right=left+item.panel.el.outerWidth();for(var i=0;i<this.items.length;i++){var n=this.items[i];if(item!=n&&n.isActived()&&n.panel&&n.panel.expanded){var ll=n.panel.el.position().left,rr=ll+n.panel.el.outerWidth();if(left>ll&&left<rr||right>ll&&right<rr||ll==left&&rr==right){if(n.panel.collapseable){n.panel.collapse()}else{n.panel.close()}}}}},active:function(o){o=this.get(o);if(!o.isActived()){o.click(true)}},onContextmenu:function(e){e.stopEvent();this.base(e)}});toolbar.item=component.extend({count:0,constructor:function(options){if(!this.el){this.el=$('<div unselectable="on">')}this.base(options);this.addEvents("click","close","expand","invalid","active")},init:function(){if(this.title){this.titleEl=$("<span unselectable='on' />").text(this.title).appendTo(this.el.addClass("z-w-text")).width(this.closeable?(typeof this.width=="number"?this.width-25:(this.width=125)-25):"auto")}if(this.icon){this.el.addClass("z-w-icon "+this.icon)}this.base();if(this.activeable){this.ct.addClass("z-w-td-active");this.ct.hoverClass("z-w-td-hover");this.el.hold("click",this.click,this)}if(this.tip){this.el.removeAttr("title");var tip=this.tipEl=$(['<div class="z-w-tip">','<span unselectable="on">',this.tip,"</span>",'<div class="z-w-tri"></div>',"</div>"].join("")).appendTo(this.ct);var _self=this;this.el.hover(function(e){if(!_self.isActived()){var cx=e.clientX,left=cx-10;tip.css("left",left).adjustPos(true).show().bgiframe();left=parseInt(tip.css("left"));if(left+10<cx){tip.find(".z-w-tri").css("left",Math.min(cx-left-3,tip.width()-12))}}},function(){tip.hide()})}if(this.closeable){$('<a class="z-w-td-close" title="Close" href="javascript:void(0)"></a>').prependTo(this.el).hold("click",this.close,this)}if(this.panel){this.setPanel(this.panel)}},setTitle:function(title){if(this.titleEl){this.titleEl.text(this.title=title)}return this},click:function(e){this.onClick();this.fireEvent("click",e,this)},onClick:function(){if(this.tipEl){this.tipEl.hide()}this.ct.toggleClass("z-w-td-clicked")},isActived:function(){return this.ct.hasClass("z-w-td-clicked")},close:function(){if(this.fireEvent("close",this)!==false){this.onClose()}},onClose:function(){this.toolbar.removeItem(this)},setPanel:function(obj){if(typeof obj=="object"&&!$.isFunction(obj.expand)){obj=new (obj.type||panel)($.extend({title:this.title||this.tip,defer:true,holder:this,renderTo:this.ct},obj))}this.panel=obj;this.on("click",obj.toggle,obj);obj.on("expand",function(){if(this.alertTimer){clearInterval(this.alertTimer);this.ct.removeClass("z-w-td-alert");this.alertTimer=null}this.fireEvent("active",this)},this);if(this.closeable){this.on("close",obj.onClose,obj)}if(obj.closeable){obj.on("close",this.close,this)}if(obj.collapseable){obj.on("collapse",this.onInvalid,this)}return this},onInvalid:function(item,e){this.ct.removeClass("z-w-td-clicked").removeClass("z-w-td-hover");this.fireEvent("invalid",e,this)},active:function(){this.toolbar.active(this);return this},alertTimer:null,alert:function(){var field=this.ct;if(!this.alertTimer){this.alertTimer=setInterval(function(){field.toggleClass("z-w-td-alert")},1000)}return this},isAlerting:function(){return this.alertTimer!=null},onContextmenu:function(e){e.stopEvent();this.base(e)}});var panel=component.extend({collapseable:true,closeable:false,autoExpand:false,constructor:function(options){this.items=[];this.base(options);this.addEvents("expand","collapse","dblclick","beforeClose","close")},init:function(){if(!this.el){this.el=$(['<div class="z-w-pn">','<div class="z-w-pn-title">','<div class="z-w-pn-btns"/>','<div class="z-w-pn-text"/>',"</div>",'<div class="z-w-pn-body"/>',"</div>"].join(""));this.body=this.el.find(".z-w-pn-body");this.titleField=this.el.find(".z-w-pn-text")}this.base();this.setTitle();if(this.closeable){this.addButton({cls:"z-w-pn-close",title:"Close",fn:this.close})}if(this.collapseable){this.addButton({cls:"z-w-pn-mini",title:"collapse",fn:this.collapse})}if(this.autoExpand){this.expand()}},setTitle:function(title){this.titleField.text((this.title=title||this.title));return this},expand:function(e){if(e){e.stopEvent()}if(!this.expanded){this.expanded=true;this.onExpand();this.fireEvent("expand",this,e)}},collapse:function(e){if(e){e.stopEvent()}if(this.expanded){this.expanded=false;this.onCollapse();this.fireEvent("collapse",this,e)}},toggle:function(){if(!this.rendered){this.init()}if(this.expanded){this.collapse()}else{this.expand()}return this},addButton:function(config){$('<a href="javascript:void(0)"/>').addClass(config.cls).attr("title",config.title).prependTo(this.el.find(".z-w-pn-btns")).hold("click",config.fn,this)},addElement:function(dom){return $('<div class="z-w-pn-item"/>').append(dom).appendTo(this.body)},close:function(e){if(e){e.stopEvent()}if(!this.closing&&this.fireEvent("beforeClose",this)!==false){this.closing=true;this.onClose();if(this.menu&&this.menu.constructor==menu){this.menu.remove()}this.fireEvent("close")}return this},onClose:function(){this.remove()},onCollapse:function(){if(this.menu&&this.menu.constructor==menu){this.menu.hide()}this.hide();return this},onExpand:function(){this.el.css("left","auto");this.show().el.bgiframe({top:true,left:true});var left=parseInt(this.el.css("left"))||this.el.position().left,w=this.el.outerWidth();if(left+w>$.windowWidth()-15){this.el.css("left",left-w+this.ct.outerWidth()+1)}return this}});var msgPanel=panel.extend({closeable:true,friend:true,cls:"z-w-mp",sign:"",bulk:false,minHeight:100,maxHeight:250,constructor:function(options){this.base(options);this.addEvents("send","addfriend")},init:function(){this.base();if(!this.friend){this.addFirendEl=$('<a class="z-w-pn-add" title="Add Friend" href="javascript:void(0)"/>').prependTo(this.titleField).hold("click",this.onAddfriend,this)}if(this.avatar||this.sex!==undefined){this.ct.addClass("z-w-mp-img");this.header=$('<div class="z-w-mp-header"/>').addClass(this.headCls).prependTo(this.el);if(this.avatar&&this.avatar.length>0){try{this.header.css("background-image","url("+this.avatar+")")}catch(e){}}else{if(this.sex!==undefined){this.header.addClass(this.sex==0?"z-w-mp-girl":"z-w-mp-boy")}}}this.info=$('<p class="z-w-mp-info"/>').text(this.sign).attr("title",this.sign).insertAfter(this.el.find(".z-w-pn-title"));$('<div class="z-w-clear">').insertAfter(this.info);this.board=this.addElement('<div class="z-w-mp-body"><ul/></div>').children();this.container=this.board.find("ul");var inputCt=this.addElement('<div class="z-w-mp-send"><input type="text"/><a class="z-w-button" href="javascript:void(0)">Send</a></div>');this.input=inputCt.find("input").width(175).hold("keyup",this.onKeyup,this).focus();inputCt.find("a").hold("click",this.onSend,this);function renderItems(){this.un("expand",arguments.callee).bulk=true;if(this.node){var _self=this;$.each(this.node.getMsgs(),function(i,n){_self.renderMsg(n.name,n.date,n.msg)})}this.container.scrollTop(10000);this.bulk=false}this.on("expand",renderItems,this).on("expand",this.focus,this).on("expand",function(){this.container.scrollTop(10000)},this)},focus:function(){this.input.focus()},onAddfriend:function(e){e.stopEvent();if(this.fireEvent("addfriend",this)===true){this.beFriend()}return this},beFriend:function(){this.addFirendEl.remove()},onKeyup:function(e){if(e.keyCode==13){this.onSend()}},MAX_LENGTH:40000,onSend:function(e){if(e){e.stopEvent()}var value=this.input.val();if(value.length>0){if(value.length>this.MAX_LENGTH){value=value.substr(0,this.MAX_LENGTH)}this.input.val("");if(this.fireEvent("send",value,this.node,this)!==false){this.insertMsg(me.getName(),new Date(),value)}}},renderMsg:function(name,date,msg){function getDate(){if(typeof date=="string"||typeof date=="number"){date=new Date(date)}else{if(date.constructor!=Date){date=new Date()}}var str="";if(date.getDate()!=new Date().getDate()){str=$.leftPad(date.getMonth(),2,"0")+"-"+$.leftPad(date.getDate(),2,"0")+" "}str+=$.leftPad(date.getHours(),2,"0")+":"+$.leftPad(date.getMinutes(),2,"0")+":"+$.leftPad(date.getSeconds(),2,"0");return str}$(["<li>","<h5>","<span>",getDate(),"</span>",name,"</h5>","<p/>","</li>"].join("")).addClass(me.getName()==name?"z-w-mp-me":"z-w-mp-chater").appendTo(this.container).find("p").text(msg);var h=0,_self=this;this.container.children().each(function(){h+=$(this).height();if(h>=_self.maxHeight){return false}});if(h>this.maxHeight){h=this.maxHeight}else{if(h<=this.minHeight){h=this.minHeight}else{h="auto"}}this.container.height(h);if(!this.bulk){this.container.scrollTop(10000)}},insertMsg:function(name,date,msg){if(this.rendered){this.renderMsg(name,date,msg)}if(this.node){this.node.addMsg(name,date,msg)}return this},clearMsg:function(){this.board.empty();this.msg.length=0}});var listPanel=panel.extend({closeable:false,emptyText:"\u67E5\u627E\u7528\u6237",autoLoad:true,allowSearch:false,height:250,constructor:function(options){this.nodes={};this.base(options);this.oldTitle=this.title||"";this.addEvents("search","removeNode","addNode","clickNode","setdata","contextmenuNode","dbclickNode")},init:function(){this.base();var emptyText=this.emptyText;this.input=this.addElement('<div class="z-w-search"><input type="text"/></div>').find("input").val(this.emptyText).focus(function(){if($(this).val()==emptyText){$(this).val("").addClass("z-w-search-focus")}}).hold("blur",this.recoverInput,this).hold("keyup",this.onKeyup,this).width(165);this.board=this.addElement('<div class="z-w-lt"><ul/></div>').children().height(this.height);this.container=this.board.find("ul");this.loading=$('<li><img class="z-w-lt-loading" src="css/default/images/s.gif"> \u6B63\u5728\u52A0\u8F7D...</li>').prependTo(this.container);var _self=this;$.each(this.nodes,function(i,n){_self.add(n)});this.on("clickNode",this.onClick,this).on("removeNode",this.onRemoveNode,this).on("contextmenuNode",this.onContextmenuNode,this)},onClick:function(node){if(node!=this.lastNode){if(this.lastNode){this.lastNode.unClick()}this.lastNode=node}},onContextmenuNode:function(e,node){if(this.fireEvent("beforecontextmenu",e,node,this)!==false){if(this.nodeMenu){e.stopEvent();if(this.nodeMenu.constructor!=menu){this.nodeMenu=new menu(this.nodeMenu)}this.nodeMenu.data=node;this.nodeMenu.showAt(e.clientX,e.clientY)}}},get:function(node){if(node.constructor==listNode){return node}else{return this.nodes[node]}},onAddNode:function(node,before){if(node.id!==this.login&&!this.nodes[node.id]){this.nodes[node.id]=node;if(this.rendered){node.renderTo=before==true?$("<li>").prependTo(this.container):$("<li>").appendTo(this.container);node.init();this.increase()}}return node},createNode:function(node){if(node.constructor!=listNode){this.nodeDefaults=this.nodeDefaults||{};for(var m in this.nodeDefaults){if(node[m]===undefined){node[m]=this.nodeDefaults[m]}}node=new listNode(node)}node.list=this;return node},add:function(node,before){node=this.createNode(node);this.fireEvent("addNode",node,this);this.onAddNode(node,before);return this},removeNode:function(node){node=this.get(node);if(node){node.remove()}return this},onRemoveNode:function(node){delete this.nodes[node.getId()];this.decrease();this.fireEvent("remove",node,this)},count:0,setNumber:function(num){if(!isNaN(num)){this.setTitle(this.oldTitle+" ("+(this.count=Math.max(num,0))+")")}return this},increase:function(num){this.setNumber(this.count+(num||1));return this},decrease:function(num){this.setNumber(this.count-(num||1));return this},refresh:function(){if(this.rendered){this.container.empty();for(var m in this.nodes){this.add(this.nodes[m])}}},recoverInput:function(){var v=this.getInput();if(v.length==0){this.input.val(this.emptyText).attr("className","");this.lastCond=null;for(var m in this.nodes){this.nodes[m].show()}}},getInput:function(){var v=$.trim(this.input.val());if(v==this.emptyText){v=""}return v},onKeyup:function(e){var v=this.getInput();if(e.keyCode==13&&v.length>0){if(this.showCount>0){this.get(this.container.find("li > div:visible:first").data("zmid")).onClick();this.recoverInput()}else{if(this.allowSearch&&this.showCount==0){if(this.searchTip){this.searchTip.hide()}this.fireEvent("search",v,this)}}}else{this.filter(v)}},filter:function(condition){if(this.lastCond!=condition){this.lastCond=condition;this.board.height(this.board.height());this.showCount=0;this.showNode=null;for(var m in this.nodes){if(this.nodes[m].login&&this.nodes[m].login.indexOf(condition)>-1||this.nodes[m].nick&&this.nodes[m].nick.indexOf(condition)>-1){this.nodes[m].show();this.showCount++}else{this.nodes[m].hide()}}if(this.allowSearch){if(this.showCount==0){this.searchTip?this.searchTip.show():this.searchTip=$('<li><img class="z-w-lt-searchTip" src="css/default/images/s.gif"> \u6309\u56DE\u8F66\u952E\u7EE7\u7EED\u67E5\u8BE2...</li>').prependTo(this.container)}else{if(this.searchTip){this.searchTip.hide()}}}}},unload:function(){this.loading.hide()},setData:function(data){this.unload();this.container.empty();this.nodes={};if(data){var _self=this;$.each(data,function(i,n){_self.add(n)});this.fireEvent("setdata",data,this)}return this}});var listNode=component.extend({defer:true,tipable:false,constructor:function(options){this.title=options.nick||options.login;this.tip=options.sign;this.id=options.login;this.options=options;this.msg=[];this.base(options);this.addEvents("click","dbclick","contextmenu","remove")},init:function(){if(!this.el){this.el=$(['<div unselectable="on" class="z-w-lt-ct">','<img class="z-w-lt-hd" src="css/default/images/s.gif" />',"<a>",'<span unselectable="on">',this.title,"</span>","</a>","</div>"].join(""));this.header=this.el.find(".z-w-lt-hd");this.titleField=this.el.find("span")}this.base();if(this.avatar||this.avatarPattern){try{var imageObj=new Image(),_self=this;imageObj.onload=function(){_self.header.attr("src",_self.avatar)};imageObj.src=(this.avatar=this.options.avatar=(this.avatar||this.matchPattern(this.avatarPattern)))}catch(e){}}if(this.profile||this.prefPattern){this.pref=this.profile||this.matchPattern(this.prefPattern)}this.setStatus(this.status);this.el.hoverClass("z-w-lt-over");this.el.hold("click",this.onClick,this)},matchPattern:function(str){if(typeof str=="string"){var reg=new RegExp("{([^}]+)}","g"),matchs,tmp=str;do{matchs=reg.exec(tmp);if(matchs){var r="";try{eval(" var r = this."+matchs[1])}catch(e){r=""}tmp=tmp.replace(matchs[0],encodeURIComponent(r))}}while(matchs!=null);return tmp}return""},onClick:function(){this.el.addClass("z-w-lt-selected");this.fireEvent("click",this)},unClick:function(){this.el.removeClass("z-w-lt-selected")},onContextmenu:function(e){e.stopEvent();this.el.addClass("z-w-lt-selected");this.list.onClick(this);this.fireEvent("contextmenu",e,this);return false},setTitle:function(title){this.titleField.text((this.title=title||this.title));return this},fireEvent:function(){arguments[0]+="Node";Array.prototype.push.call(arguments,this.list);if(this.list){this.list.fireEvent.apply(this.list,arguments)}},setRightTip:function(icon,cls){if(this.tipable){if(!this.rightField){this.rightField=$('<img class="z-w-lt-tipicon" src="css/default/images/s.gif" />').prependTo(this.el)}this.tipImg=icon||this.tipImg;this.tipCls=cls||this.tipCls;if(this.tipCls){this.rightField.attr("className","z-w-lt-tipicon "+this.tipCls)}if(this.tipImg){try{this.rightField.css("backgroundImage",this.tipImg)}catch(e){}}}},setStatus:function(s){this.setRightTip(true,s!="OFFLINE"?"z-w-lt-online":"z-w-lt-offline")},remove:function(){this.base();if(this.ct){this.ct.remove()}this.fireEvent("remove",this)},show:function(){this.base();if(this.ct){this.ct.show()}return this},hide:function(){this.base();if(this.ct){this.ct.hide()}return this},addMsg:function(name,date,msg){this.msg.push({name:name,date:date,msg:msg})},getMsgs:function(){return this.msg}});var feedback=panel.extend({closeable:false,emptyText:"suggest.",TextThanks:"Thank you!",width:180,constructor:function(options){this.base(options);this.addEvents("send")},init:function(){this.base();var emptyText=this.emptyText;this.board=this.addElement("<textarea>"+this.emptyText+'</textarea><a class="z-w-button" href="javascript:void(0)">OK</a>').find("textarea").css("border","none").focus(function(){if($(this).val()==emptyText){$(this).val("").addClass("z-w-search-focus")}}).blur(function(){var v=$.trim($(this).val());if(v.length==0||v==emptyText){$(this).val(emptyText).removeClass("z-w-search-focus")}});var _self=this;this.btn=this.board.next("a").css("float","right").click(function(e){e.stopEvent();var text=$(this).prev("textarea"),v=$.trim(text.val());if(v.length!=0&&v!=emptyText){_self.fireEvent("send",v,_self);text.val(_self.TextThanks).removeClass("z-w-search-focus");setTimeout(function(){_self.collapse(true)},1000)}});this.ct.children("div:first").css("border-left","1px solid #e3e3e3")}});var menu=component.extend({constructor:function(options){this.renderTo=el||"body";this.base(options);this.addEvents("beforeshow","show")},init:function(){this.el=$(['<div class="z-w-mn">','<a class="z-w-mn-focus" tabindex="-1" onclick="return false;" href="#"></a>',"<ul/>","</div>"].join(""));this.board=this.el.find("ul");this.base();if($.isArray(this.items)&&this.items.length>0){var arr=this.items.slice(0,this.items.length);this.items.length=0;for(var i=0;i<arr.length;i++){this.add(arr[i])}}else{this.board.hide()}menuMgr.reg(this)},add:function(){for(var i=0,a=arguments;i<a.length;i++){var obj=a[i];if(obj=="-"){this.addSeparator()}else{if(typeof obj=="object"){if(obj.constructor!=menu.item){obj=new menu.item(obj)}this.addItem(obj)}}}return this},addSeparator:function(){this.addItem(new component({defer:true,dom:$("<span/>").html("&nbsp;"),ctCls:"z-w-mn-sep"}))},addItem:function(item){if(this.rendered){$.extend(item,{renderTo:$("<li>").appendTo(this.board),parent:this});item.init();item.on("click",this.hide,this);this.items.push(item);this.board.show();return item}else{this.items.push(item)}},showAt:function(left,top){if(this.fireEvent("beforeshow",this)!==false){menuMgr.active(this);if(left.screenX){left=e.screenX;top=e.screenY}var bottom=Math.max($.windowHeight()-top-this.el.height(),0);this.el.css({left:left,bottom:bottom}).show().width(this.el.find("li a").outerWidth()+20).adjustPos(true,false).bgiframe();this.fireEvent("show",this)}return this},onContextmenu:function(e){e.stopEvent();return false},remove:function(){this.base();menuMgr.unreg(this)}});var menuMgr=(function(){var items=[],current=null;return{reg:function(menu){if($.inArray(menu,items)==-1){items.push(menu)}},unreg:function(menu){if(menu.constructor==menu){var i=$.inArray(menu,items);if(i>-1){items.splice(i,1)}}},active:function(menu){current=menu;$.each(items,function(i,n){if(n!=menu){n.hide()}});$(document).one("click",function(){if(current&&current.hide){current.hide()}})}}})();menu.item=component.extend({defer:true,constructor:function(options){this.base(options);this.addEvents("click","close")},init:function(){this.el=$(['<a href="javascript:void(0)" unselectable="on" hidefocus="true" target="_blank">',"</a>"].join("")).text(this.text||this.title).prepend('<img src="css/default/images/s.gif"/>').hold("click",this.onClick,this);this.img=this.el.children("img").addClass(this.iconCls);if(this.icon){this.img.css("background-image","url("+this.icon+")")}this.base();this.ct.hoverClass("z-w-mn-hover");this.parent.on("show",this.onParentShow,this);if(this.handler){this.on("click",this.handler,this.scope||this)}},onParentShow:function(parent){if(this.href){var str=this.href;if($.isFunction(this.href)){str=this.href(this)}this.el.attr("href",""+str)}},onClick:function(e){this.fireEvent("click",this,this.parent.data);if(!this.href){e.preventDefault()}return false}});var win=component.extend({alertting:false,title:"Tips",constructor:function(options){this.base(options);this.addEvents("yes","no","cansel","close")},init:function(){this.el=$(['<div class="z-w-win">','<div class="z-w-pn-title z-w-win-title">','<div class="z-w-pn-btns">','<a class="z-w-pn-close" title="Close" href="javascript:void(0)"></a>',"</div>",'<div class="z-w-pn-text"/>',"</div>",'<div class="z-w-win-body"/>','<center class="z-w-win-btn" />',"</div>"].join(""));this.body=this.el.find(".z-w-win-body");this.btns=this.el.find(".z-w-win-btn");this.renderTo="body";this.el.find(".z-w-pn-close").hold("click",this.close,this);this.base()},setTitle:function(title){this.el.find(".z-w-pn-text").text(this.title);return this},mask:function(){var h=0;$("body").children().each(function(){h+=$(this).outerHeight()});if(!this.maskEl){this.maskEl=$('<div class="z-w-win-mask"></div>').css("opacity",0.5).height(Math.max(h,Math.max(document.body.clientHeight,$(window).height()))).appendTo("body").bgiframe()}return this},unmask:function(){if(this.maskEl){this.maskEl.remove()}delete this.maskEl;return this},setButton:function(){this.btns.empty();var events=["yes","no","cansel"],_self=this;for(var i=0,a=arguments;i<a.length;i++){(function(){var v=events[i];$('<a class="z-w-button" href="javascript:void(0)">'+a[i]+"</a>").appendTo(_self.btns).hold("click",function(e){if(e){e.stopEvent()}if(this.fireEvent(v,this,this.body.text()||this.body.find("textarea").val())!==false){this.close()}},_self)})()}return this},setBody:function(str){this.body.empty().append(str);this.mask();return this},show:function(){if(this.el.css("position")!="fixed"){this.el.css({position:"absolute",bottom:"auto",top:200+document.body.scrollTop})}this.base();this.el.bgiframe();return this},close:function(e){if(e){e.stopEvent()}if(this.fireEvent("close")!==false){this.hide().unmask()}this.purgeListeners()},prompt:function(str){return this.setTitle("Prompt").setBody($("<textarea>").val(str).focus(function(){$(this).val("")})).setButton("OK","Cansel").show()},alert:function(str){return this.setTitle("Alert").setBody(str).setButton("OK").show()},confirm:function(str){return this.setTitle("Confirm").setBody(str).setButton("Yes","No").show()}});win=new win();var TitleMgr=(function(){var oldTitle=document.title,interval=1000,count=0,msg="New Message",blank="",focus=true,blanking=false,items={},timer=null;var SoundMgr=null;function alert(){if(!timer){timer=setInterval(function(){if(blanking){blanking=false;document.title=msg+oldTitle}else{blanking=true;document.title=blank+oldTitle}},interval)}}function stopAlert(){if(timer){clearInterval(timer)}timer=null;document.title=oldTitle}$(document).mouseout(function(){focus=false;if(has()){alert()}$(this).one("mouseover",function(){focus=true})});function has(){for(var m in items){if(m!==undefined){return true}}return false}return{set:function(m,b){if(m){msg=m}if(b){blank=b}},start:function(key){if(items[key]===undefined){items[key]=true;if(!focus){alert()}}},stop:function(key){delete items[key];if(!has()){stopAlert()}}}})();initService({domain:domain,alias:alias}).start(function(){s.getSecret({params:[domain,login,stoken],fn:function(response){secret=response;var bar=new toolbar({listeners:{close:function(ct){Slave.report(EventType.TYPE_DELCT,"",ct.id)},clickItem:function(e,ct){if(e){Slave.report(EventType.TYPE_CLICKCT,"",ct.id)}},invalidItem:function(e,ct){if(e){Slave.report(EventType.TYPE_PANELCLP,"",ct.id)}}}});bar.add({id:"__feedback",icon:"z-w-feedback",tip:"feedback",width:"auto",activeable:true,panel:{type:feedback,listeners:{send:function(v){s.submitFeedback([domain,login,secret,v])}}}},"->");function addBuddy(name,blogin,fn){if(needRequest){win.prompt("You are inviting ["+name+"] as your friend,please input some infomation").on("yes",function(win,text){s.buddyReq([domain,login,secret,blogin,text]);if(buddyRequest){hs.buddyRequest({login:login,token:token,blogin:blogin})}})}else{s.buddyAdd([domain,login,secret,blogin,""]);if(buddyAddDirectly){hs.buddyAddDirectly({login:login,token:token,blogin:blogin})}if(fn){fn()}}}function shiftStatus(evt){var node=(bdPanel?bdPanel.get(evt.from):null)||(olPanel?olPanel.get(evt.from):null);if(node){node.setStatus(evt.msg)}if(evt.msg=="OFFLINE"){var ct=bar.get(evt.from);if(ct&&ct.panel&&ct.panel.status!="OFFLINE"){ct.panel.status="OFFLINE";ct.panel.insertMsg("System",evt.time,"*** this buddy is offline ***")}}}function addChat(node,active){Slave.report(EventType.TYPE_ADDCT,{login:node.options.login,nick:node.options.nick});return _addChat(node)}function _addChat(node){var config=$.extend({node:node,friend:!addable||((bdPanel&&bdPanel.get(node.id))?true:false),type:msgPanel,listeners:{addfriend:{fn:function(panel){var node=panel.node;addBuddy(node.title,node.login,function(){if(bdPanel&&bdPanel.rendered){node.remove();bdPanel.add(node.options)}});return needRequest!=true}},send:{fn:function(v,node){s.whisper({params:[domain,login,secret,node.login,v],fn:function(online){if(online===false){shiftStatus({from:node.login,msg:"OFFLINE",time:+new Date()})}}});Slave.report(EventType.TYPE_SENDMSG,v,node.id)}}}},node.options);var temp=bar.addButton({id:node.id,title:node.title,closeable:true,panel:config},1);if(temp.panel.expanded){temp.panel.focus()}return temp}function addListNode(node){Slave.report(EventType.TYPE_ADDNODE,{login:node.options.login,nick:node.options.nick},node.list.holder.id)}function removeListNode(node){Slave.report(EventType.TYPE_DELNODE,node.id,node.list.holder.id)}if(userList){var itemsArray=[{text:"View Profile",iconCls:"z-m-mn-viewb",href:function(item){return item.parent.data.pref||""}}];if(addable){itemsArray.push("-",{text:"Add friend",iconCls:"z-m-mn-addb",handler:function(item,node){if(bdPanel&&bdPanel.get(node.id)){return false}addBuddy(node.title,node.login,function(){if(bdPanel&&bdPanel.rendered){node.remove();bdPanel.add(node.options)}})}})}var olBtn=bar.addButton({id:"__online",icon:"z-w-onlines",title:"User List",activeable:true,panel:{type:listPanel,login:login,allowSearch:userSearch===true,nodeDefaults:{tipable:true,prefPattern:prefPattern,avatarPattern:avatarPattern},nodeMenu:{items:itemsArray}}});var olPanel=olBtn.panel;olPanel.on("clickNode",function(node){olBtn.click(true);addChat(node).active()}).on("search",function(v){if(userSearch){hs.userSearch({login:login,token:token,user:v},function(rep){if(rep){if(!$.isArray(rep)){rep=[rep]}$.each(rep,function(i,n){olPanel.add(n,true)})}})}}).on("addNode",addListNode).on("removeNode",removeListNode)}if(buddyList){var itemsArrayBuddy=[{text:"View Profile",iconCls:"z-m-mn-viewb",href:function(item){return item.parent.data.pref||""}}];if(buddyRemove){itemsArrayBuddy.push("-",{text:"Delete Friend",iconCls:"z-m-mn-rmb",handler:function(item,node){win.confirm("Are you sure to delete ["+node.title+"] ?").on("yes",function(){var ct=bar.get(node.id);if(ct){ct.close()}node.remove();s.buddyDel([domain,login,secret,node.login,""]);if(buddyRemove){hs.buddyRemove({login:login,token:token,blogin:node.login})}})}})}var bdBtn=bar.addButton({id:"__buddy",icon:"z-w-buddy",title:"Buddy List",activeable:true,panel:{type:listPanel,login:login,nodeDefaults:{tipable:true,prefPattern:prefPattern,avatarPattern:avatarPattern},nodeMenu:{items:itemsArrayBuddy}}});var bdPanel=bdBtn.panel;bdPanel.on("clickNode",function(node){bdBtn.click(true);addChat(node).active()}).on("addNode",addListNode).on("removeNode",removeListNode)}function getNode(config,fn){var node=(bdPanel?bdPanel.get(config.login):null)||(olPanel?olPanel.get(config.login):null);function newNode(config){return(olPanel?olPanel.add(config).get(config.login):null)||new listNode(config)}if(!node){if(userSearch&&!config.nick){hs.userSearch({login:login,token:token,user:config.login},function(rep){if(rep){config=rep[0]||rep}fn(newNode(config))})}else{fn(newNode(config))}}else{fn(node)}}s.domainSelect({params:[domain,login,secret],fn:function(response){response={reqUrl:"post.html"};if(response&&response.reqUrl){initHostService({reqUrl:response.reqUrl,domain:domain}).start(function(){function loadData(method){if(this.count==0){hs[method]({token:token,login:login},function(data){if(this.count==0){this.setData(data)}this.unload()},this)}}if(userList){olPanel.on("expand",function(){this.un("expand",arguments.callee);loadData.call(this,"userList")},olPanel)}if(buddyList){bdPanel.on("expand",function(){this.un("expand",arguments.callee);loadData.call(this,"buddyList")},bdPanel).on("setdata",function(data){var arr=[];for(var ii=0;ii<data.length;ii++){if(data[ii].status!="OFFLINE"&&data[ii].login){arr.push(data[ii].login)}}if(arr.length>0){var str='["'+arr.join('","')+'"]';s.buddyUpload([domain,login,secret,str])}})}Slave.init().start();Master.createSnapShot=function(){};cookieChecker.init(login,initMaster).start()})}}});Slave.on(EventType.TYPE_CONNECT_FROM_OTHER,function(evt){receptDestroy(true)});if(bdPanel){if(buddyAccept||buddyReject){Slave.on(EventType.TYPE_BUDDY_REQ,function(evt){if(!(bdPanel&&bdPanel.get(evt.from))){TitleMgr.start("__win");win.confirm(evt.from+"request you as friend<br/>More Infomation:"+(evt.msg||"")).on("yes",function(){bdPanel.add({login:evt.from,nick:evt.name||evt.from});s.buddyAccept([domain,login,secret,evt.from]);if(buddyAccept){hs.buddyAccept({login:login,token:token,blogin:evt.from})}}).on("no",function(){s.buddyReject([domain,login,secret,evt.from,""]);if(buddyReject){hs.buddyReject({login:login,token:token,blogin:evt.from})}}).on("close",function(){TitleMgr.stop("__win")})}})}function newBuddy(evt){var node=olPanel?olPanel.get(evt.from):null;if(!node){bdPanel.add({login:evt.from})}else{node.remove();var ct=bar.get(node.id);if(ct&&ct.panel&&ct.panel.expanded){ct.panel.beFriend()}bdPanel.add(node.options)}}Slave.on(EventType.TYPE_BUDDY_ADD,newBuddy).on(EventType.TYPE_BUDDY_ACCEPT,newBuddy)}Slave.on(EventType.TYPE_MSG_WHISPER,function(evt){getNode({login:evt.from},function(node){var ct=bar.get(node.id);TitleMgr.start(node.id);if(ct&&ct.panel){ct.panel.insertMsg(node.title,evt.time,evt.msg);if(ct.panel.expanded){$(document).one("mouseover",function(){TitleMgr.stop(node.id)})}else{ct.alert()}}else{node.addMsg(node.title,evt.time,evt.msg);ct=addChat(node).alert()}ct.on("click",function(){node.un("click",arguments.callee);TitleMgr.stop(node.id)}).on("close",function(){node.un("close",arguments.callee);TitleMgr.stop(node.id)})})}).on(EventType.TYPE_BUDDY_REJECT,function(evt){TitleMgr.start("__win");win.alert("["+evt.from+"] reject your invite").on("close",function(){TitleMgr.stop("__win")})}).on(EventType.TYPE_STATUS_CHANGE,shiftStatus);Slave.on(EventType.TYPE_CLICKCT,function(evt){var ct=bar.get(evt.item);if(ct){ct.click()}}).on(EventType.TYPE_ADDCT,function(evt){getNode(evt.msg,_addChat)}).on(EventType.TYPE_DELCT,function(evt){var ct=bar.get(evt.item);if(ct){ct.onClose()}}).on(EventType.TYPE_ADDNODE,function(evt){var ct=bar.get(evt.item);if(ct){var list=ct.panel;list.onAddNode(list.createNode(evt.msg))}}).on(EventType.TYPE_DELNODE,function(evt){var ct=bar.get(evt.item);if(ct){var list=ct.panel,node=list.get(evt.msg);if(node){node.remove()}}}).on(EventType.TYPE_SENDMSG,function(evt){var ct=bar.get(evt.item);if(ct){ct.panel.insertMsg(me.getName(),evt.clientTime,evt.msg)}}).on(EventType.TYPE_PANELCLP,function(evt){var ct=bar.get(evt.item);if(ct){ct.panel.collapse()}});var receptInited=false,receptIniting=false;function initMaster(){if(receptInited===true){handleStore();return true}if(receptIniting){return false}receptIniting=true;Master.init({domain:domain,secret:secret,login:login,alias:alias,token:token}).start(function(){receptIniting=false;receptInited=true;Slave.stop();if(statusChanged&&hs){hs.statusChanged({login:login,token:token,status:"ONLINE",nick:nick})}if(statusChanged){Master.error=function(){receptDestroy();Master.error=function(){};try{setTimeout(function(){hs.statusChanged({login:login,token:token,status:"OFFLINE"})},Math.random()*1000*20)}catch(e){}}}Master.onFailed=receptDestroy;handleStore()})}function receptDestroy(change){receptInited=receptIniting=false;cookieChecker.turnOffRecept(change);Master.setCounter(0)}function handleStore(){$.each(Zibar.store.addChatPanel,function(blogin,config){config=config||{};config.login=blogin;getNode(config,function(node){addChat(node).active()})});Zibar.store.addChatPanel={}}var mousetimer;function onMouseout(){if(mousetimer){clearTimeout(mousetimer)}mousetimer=setTimeout(function(){Slave.stop()},10000);$(document).one("mouseover",function(){if(mousetimer){clearTimeout(mousetimer)}if(!Master.running){Slave.start()}})}$(document).mouseout(onMouseout)}})})})();
